<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1">
    <title>Panel de administración</title>
    <link rel="stylesheet" href="admincss/styledashboard.css">
    <link rel="stylesheet" href="productos.js" type="text/css" />
    <link rel="stylesheet"
        href="https://maxst.icons8.com/vue-static/landings/line-awesome/line-awesome/1.3.0/css/line-awesome.min.css">


</head>

<body onload="leerProducto()">
    <input type="checkbox" id="menu-toggle">
    <div class="sidebar">
        <div class="side-header">
            <h3>G<span>rupo + Limpio</span></h3>
        </div>

        <div class="side-content">
            <div class="profile">
                <div class="profile-img bg-img" style="background-image: url(img_admin/3.jpeg)"></div>
                <h4>Inicio</h4>

            </div>

            <div class="side-menu">
                <ul>
                    <li>
                        <a href="index_admin.html">
                            <span class="las la-home"></span>
                            <small>Inicio</small>
                        </a>
                    </li>
                    <li>
                        <a href="productos_admin.html" class="active">
                            <span class="las la-shopping-cart"></span>
                            <small>Cátalogo</small>
                        </a>
                    </li>
                    <li>
                        <a href="servicios_admin.html">
                            <span class="las la-clipboard-list"></span>
                            <small>Servicios</small>
                        </a>
                    </li>
                    <li>
                        <a href="repartidor_admin.html">
                            <span class="las la-truck"></span>
                            <small>Repartidor</small>
                        </a>
                    </li>
                    <li>
                        <a href="pedidos_admin.html">
                            <span class="las la-clipboard-check"></span>
                            <small>Pedidos</small>
                        </a>
                    </li>
                    <li>
                        <a href="marcas_admin.html">
                            <span class="las la-store"></span>
                            <small>Marcas propias</small>
                        </a>
                    </li>
                    <li>
                        <a href="carrusel_admin.html">
                            <span class="las la-store"></span>
                            <small>Carrusel Inicial</small>
                        </a>
                    </li>
                    <li>
                        <a href="carruselmarcas_admin.html">
                            <span class="las la-store"></span>
                            <small>Carrusel Marcas</small>
                        </a>
                    </li>
                    <li>
                        <a href="modificarcarrusel.html">
                            <span class="las la-store"></span>
                            <small>Pagina</small>
                        </a>
                    </li>
                    <li>
                        <a href="index.html">
                            <span class="las la-sign-out-alt"></span>
                            <small>Salir</small>
                        </a>
                    </li>

                </ul>
            </div>
        </div>
    </div>

    <div class="main-content">

        <header>
            <div class="header-content">
                <label for="menu-toggle">
                    <span class="las la-bars"></span>
                </label>
                <div class="header-menu">
                    <div class="user">

                        <button id="CSAdmin" class="logout-link" > Cerrar Sesión </button>
                    </div>
                </div>
            </div>
        </header>


        <main>
            <div class="page-header">
                <h1>Productos</h1>
                <small>Panel / Productos</small>
            </div>
            <div class="page-content">
                <div class="records table-responsive">
                    <div class="record-header">
                        <div class="add">
                            <button id="openForm">Agregar</button>
                        </div>
                        <!-- <div class="browse">
                            <input type="search" placeholder="Buscar" class="record-search">
                            <select name="" id="">
                                <option value="">Estado</option>
                            </select>
                        </div> -->
                    </div>
                    <div>
                        <table id="TablaProductos" class="product-table">
                            <style>
                                body {
                                    font-family: Arial, sans-serif;
                                    margin: 0;
                                    padding: 0;
                                    display: flex;
                                    justify-content: center;
                                    align-items: center;

                                    background-color: #f5f5f5;
                                }

                                .product-table {
                                    width: 100%;
                                    border-collapse: collapse;
                                    margin-top: 20px;
                                }

                                .product-table th,
                                .product-table td {
                                    border: 1px solid #e7e7e7;
                                    padding: 8px;
                                    text-align: left;
                                }

                                .product-table th {
                                    background-color: #4bcf23c2;
                                }

                                .product-table h4 {
                                    margin: 0;
                                    font-size: 1em;
                                }

                                .product-table p {
                                    margin: 0;
                                    font-size: 0.8em;
                                }

                                .client-img-catalogo {
                                    width: 50px;
                                    height: 50px;
                                    background-size: cover;
                                }

                                .actions {
                                    display: flex;
                                }

                                .action-link {
                                    margin-right: 10px;
                                    text-decoration: none;
                                }
                            </style>
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>NOMBRE</th>
                                    <th>PRECIO</th>
                                    <th>MARCA</th>
                                    <th>CATEGORIA</th>
                                    <th>IMAGEN 1</th>
                                    <th>IMAGEN 2</th>
                                    <th>IMAGEN 3</th>
                                    <th>DESCRIPCIÓN</th>
                                    <th>FECHA</th>
                                    <th>PRECIO VENTA</th>
                                    <th>ESTADO</th>
                                    <th>OPCIONES</th>
                                </tr>
                            </thead>
                            
                        </table>
                    </div>
                </div>
            </div>
        </main>
    </div>


    <div id="myModal" class="modal">
        <div class="modal-content">
            <span class="close">×</span>
            <h2>Agregar Producto</h2>
            <hr>

            <div class="form-container">
                <div class="row">
                    <div class="column">
                        <!-- <label for="id">ID:</label>
                        <input type="text" id="id" name="id"> -->

                        <label for="nombre">Nombre de Producto:</label>
                        <input type="text" id="nombre" name="nombre">

                        <label for="precio">Precio (en Lempiras):</label>
                        <input type="number" id="precio" name="precio" placeholder="L. 00.00">

                        <label for="marca">Marca:</label>
                        <input type="text" id="marca" name="marca">

                        <label for="categoria">Categoría:</label>
                        <select id="categoria" name="categoria">
                            <option value="Baño">Baños</option>
                            <option value="Lavandería">Lavandería</option>
                            <option value="Herramientas">Herramientas de Limpieza</option>
                            <option value="Bioseguridad">Bioseguridad</option>
                            <option value="Desinfectante">Desinfectante</option>
                            <option value="Cuidado Personal">Cuidado Personal</option>
                            <option value="Productos Plasticos">Productos Plasticos</option>
                        </select>

                        <label for="imagen1">Imagen 1:</label>
                        <input type="text" id="imagen1" name="imagen1">

                        <label for="imagen2">Imagen 2:</label>
                        <input type="text" id="imagen2" name="imagen2">

                    </div>

                    <div class="column">

                        <label for="imagen3">Imagen 3:</label>
                        <input type="text" id="imagen3" name="imagen3">

                        <label for="cantidad">Cantidad:</label>
                        <input type="number" id="cantidad" name="cantidad">

                        <label for="descripcion">Descripción:</label>
                        <textarea id="descripcion" name="descripcion"></textarea>

                        <label for="fecha">Fecha:</label>
                        <input type="date" id="fecha" name="fecha">

                        <label for="precioventa">Precio de Venta (L. 00.00):</label>
                        <input type="number" id="precioventa" name="precioventa" placeholder="L. 00.00">

                        <label for="estado">Estado:</label>
                        <select id="estado" name="estado">
                            <option value="Activo">Activo</option>
                            <option value="Desactivo">Desactivo</option>
                        </select>
                    </div>
                </div>

                <div class="buttons">
                    <button id="aceptarAgregar">Aceptar</button>
                </div>
            </div>
        </div>
    </div>



    <div id="myModal_Modificar" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModificarModal()">×</span>
            <h2>Modificar</h2>
            <hr>

            <div class="form-container">
                <div class="row">
                    <div class="column">

                        <label for="nombre2">Nombre de Producto:</label>
                        <input type="text" id="nombre2" name="nombre2">

                        <label for="precio2">Precio (L. 00.00):</label>
                        <input type="number" id="precio2" name="precio2" placeholder="L. 00.00">

                        <label for="marca2">Marca:</label>
                        <input type="text" id="marca2" name="marca2">

                        <label for="categoria2">Categoría:</label>
                        <select id="categoria2" name="categoria2">
                            <option value="Baños">Baños</option>
                            <option value="Lavandería">Lavandería</option>
                            <option value="Herramientas de limpieza">Herramientas de Limpieza</option>
                            <option value="Bioseguridad">Bioseguridad</option>
                            <option value="Desinfectante">Desinfectante</option>
                            <option value="Cuidado Personal">Cuidado Personal</option>
                            <option value="Productos Plásticos">Productos Plasticos</option>
                        </select>

                        <label for="imagen12">Imagen 1:</label>
                        <input type="text" id="imagen12" name="imagen12">

                        <label for="imagen22">Imagen 2:</label>
                        <input type="text" id="imagen22" name="imagen22">
                    </div>

                    <div class="column">

                        <label for="imagen32">Imagen 3:</label>
                        <input type="text" id="imagen32" name="imagen32">

                        <label for="cantidad2">Cantidad:</label>
                        <input type="number" id="cantidad2" name="cantidad2">

                        <label for="descripcion2">Descripción:</label>
                        <textarea id="descripcion2" name="descripcion2"></textarea>

                        <label for="fecha2">Fecha:</label>
                        <input type="date" id="fecha2" name="fecha2">

                        <label for="precioventa2">Precio de Venta (L. 00.00):</label>
                        <input type="number" id="precioventa2" name="precioventa2" placeholder="L. 00.00">

                        <label for="estado2">Estado:</label>
                        <select id="estado2" name="estado2">
                            <option value="Activo">Activo</option>
                            <option value="Desactivo">Desactivo</option>
                        </select>
                    </div>
                </div>

                <div class="buttons">
                    <button id="aceptarModificar">Aceptar</button>
                    <button id="cancelar" onclick="closeModificarModal()">Cancelar</button>
                </div>
            </div>
        </div>
    </div>

    <div id="myModal_Eliminar" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeEliminarModal()">×</span>
            <h2>Confirmación de Eliminación</h2>
            <hr>

            <p>¿Está seguro de que desea eliminar este producto? Esta acción es permanente.</p>

            <div class="buttons">
                <button id="confirmarEliminar">Confirmar</button>
                <button id="cancelarEliminar" onclick="closeEliminarModal()">Cancelar</button>
            </div>
        </div>
    </div>

    <script>
        function openEliminarModal(data) {

            var modalEliminar = document.getElementById('myModal_Eliminar');
            modalEliminar.style.display = 'block';
            localStorage["idP"] = data;

        }

        function closeEliminarModal() {
            var modalEliminar = document.getElementById('myModal_Eliminar');
            modalEliminar.style.display = 'none';
        }

        function eliminarCambio() {
            // Agrega aquí la lógica para eliminar el cambio
            // Puedes hacer una petición AJAX u otro método según tu aplicación
            alert('Cambio eliminado'); // Muestra una alerta como ejemplo
            closeEliminarModal(); // Cierra el modal después de confirmar
        }
    </script>


    <script src="producto.js"></script>

</body>
<script>
    function openModificarModal(data) {
        console.log("Hola");
        var modalModificar = document.getElementById('myModal_Modificar');
        modalModificar.style.display = 'block';
        localStorage["idP"] = data;
        leerModificar(data);
    }

    function closeModificarModal() {
        var modalModificar = document.getElementById('myModal_Modificar');
        modalModificar.style.display = 'none';
    }
</script>

<script>
    const Tabla = document.getElementById('TablaProductos');
    const getBtnLO = document.getElementById('CSAdmin');
    const Agregarbtn = document.getElementById('aceptarAgregar');
    const Modificarbtn = document.getElementById('aceptarModificar');
    const Eliminarbtn = document.getElementById('confirmarEliminar');

    const category = document.getElementById('categoria');
    const brand = document.getElementById('marca');
    const productName = document.getElementById('nombre');
    const productImage = document.getElementById('imagen1'); 
    const productImage2 = document.getElementById('imagen2'); 
    const productImage3 = document.getElementById('imagen3'); 
    const productPrice = document.getElementById('precio');
    const productPriceSale = document.getElementById('precioventa');
    const productQuantity = document.getElementById('cantidad');
    const productState = document.getElementById('estado');
    const productDate = document.getElementById('fecha');
    const productDescription = document.getElementById('descripcion');

    const category2 = document.getElementById('categoria2');
    const brand2 = document.getElementById('marca2');
    const productName2 = document.getElementById('nombre2');
    const productImage12 = document.getElementById('imagen12'); 
    const productImage22 = document.getElementById('imagen22'); 
    const productImage32 = document.getElementById('imagen32'); 
    const productPrice2 = document.getElementById('precio2');
    const productPriceSale2 = document.getElementById('precioventa2');
    const productQuantity2 = document.getElementById('cantidad2');
    const productState2 = document.getElementById('estado2');
    const productDate2 = document.getElementById('fecha2');
    const productDescription2 = document.getElementById('descripcion2');

    getBtnLO.addEventListener('click', CerrarSesion);
    Agregarbtn.addEventListener('click', PreSubmitData);
    Modificarbtn.addEventListener('click', PreActualizar);
    Eliminarbtn.addEventListener('click', Eliminar);

    const baseUrl = 'https://grupolimpio-api.onrender.com';

    function Eliminar() {
        fetch(baseUrl + '/EliminarProducto', {
            method: 'POST',
            headers: {
            'Content-Type': 'application/json',
            },
            body: JSON.stringify({ nombre: localStorage["idP"],}),
        })
        .then(response => response.json())
        .then(data => {
            alert('El producto a sido eliminado');
            var modalEliminar = document.getElementById('myModal_Eliminar');
            modalEliminar.style.display = 'none';
            location.reload();
        })
        .catch(error => {
            alert('No se ha podido eliminar el producto');
        });
    }

    function Actualizar() {
            fetch(baseUrl + '/ActualizarProducto', {
                method: 'POST',
                headers: {
                'Content-Type': 'application/json',
                },
                body: JSON.stringify({ nombre: productName2.value, categoria: category2.value, marca: brand2.value, imagen1: productImage12.value, 
                    imagen2: productImage22.value, imagen3: productImage32.value, precio: +productPrice2.value, precioventa: +productPriceSale2.value,
                    cantidad: +productQuantity2.value, estado: productState2.value, fecha: productDate2.value, descripcion: productDescription2.value,
                    id: localStorage["idP"]}),
            })
            .then(response => response.json())
            .then(data => {
                alert('El producto a sido actualizado');
                var modalModificar = document.getElementById('myModal_Modificar');
                modalModificar.style.display = 'none';
                location.reload();
            })
            .catch(error => {
                alert('No se ha podido actualizar su informacion');
            });
        }
    
    function PreSubmitData(){
        if(productName.value == ""){
            alert("Ingrese el nombre del producto");
        }
        else if(+productPrice.value < 1){
            alert("Ingrese el precio del producto");
        }
        else if(brand.value == ""){
            alert("Ingrese la marca del producto");
        }
        else if(category.value == ""){
            alert("Seleccione la categoria del producto");
        }
        else if(productImage.value == ""){
            alert("Ingrese una imagen en el campo imagen1");
        }
        else if(productImage2.value == ""){
            alert("Ingrese una imagen en el campo imagen2");
        }
        else if(productImage3.value == ""){
            alert("Ingrese una imagen en el campo imagen3");
        }
        else if(+productQuantity.value < 1){
            alert("Ingrese la cantidad del producto");
        }
        else if(productDescription.value == ""){
            alert("Ingrese la descripcion del producto");
        }
        else if(productDate.value == ""){
            alert("Ingrese la fecha del producto");
        }
        else if(+productPriceSale.value < 1){
            alert("Ingrese el precio de venta del producto");
        }
        else if(productState.value == ""){
            alert("Seleccione el estado del servicio");
        }
        else{
            submitData();
        }
    }

    function PreActualizar(){
        if(productName2.value == ""){
            alert("Ingrese el nombre del producto");
        }
        else if(+productPrice2.value < 1){
            alert("Ingrese el precio del producto");
        }
        else if(brand2.value == ""){
            alert("Ingrese la marca del producto");
        }
        else if(category2.value == ""){
            alert("Seleccione la categoria del producto");
        }
        else if(productImage12.value == ""){
            alert("Ingrese una imagen en el campo imagen1");
        }
        else if(productImage22.value == ""){
            alert("Ingrese una imagen en el campo imagen2");
        }
        else if(productImage32.value == ""){
            alert("Ingrese una imagen en el campo imagen3");
        }
        else if(+productQuantity2.value < 1){
            alert("Ingrese la cantidad del producto");
        }
        else if(productDescription2.value == ""){
            alert("Ingrese la descripcion del producto");
        }
        else if(productDate2.value == ""){
            alert("Ingrese la fecha del producto");
        }
        else if(+productPriceSale2.value < 1){
            alert("Ingrese el precio de venta del producto");
        }
        else if(productState2.value == ""){
            alert("Seleccione el estado del producto");
        }
        else{
            Actualizar();
        }
    }

    function CerrarSesion() {
      fetch(baseUrl + '/logOut', {
        method: 'GET',
        headers: {
          'Content-Type': 'application/json',
        },
      })
        .then(response => response.json())
        .then(data => {
          if (data.msg == "log out") {
            alert('Se ha cerrrado sesion');
            localStorage.removeItem('Admin');
            localStorage.removeItem('correo');
            window.location.href = "index.html";
          } else {

          }
        })
        .catch(error => {
          alert('No se ha podido cerrar sesion');
        });
    }

    function submitData() {
        fetch(baseUrl + '/submitProducto', {
            method: 'POST',
            headers: {
            'Content-Type': 'application/json',
            },
            body: JSON.stringify({ nombre: productName.value, categoria: category.value, marca: brand.value, imagen1: productImage.value, id: '',
                imagen2: productImage2.value, imagen3: productImage3.value, precio: +productPrice.value, cantidad: +productQuantity.value,
                precioventa: +productPriceSale.value, fecha: productDate.value, descripcion: productDescription.value, estado: productState.value,
                carrusel: 'No'}),
        })
        .then(response => response.json())
        .then(data => {
            console.log(data);
            Tabla.innerHTML += `
            <tbody>
                <tr>
                    <td>`+data.id+`</td>
                    <td>
                        <h4>`+productName.value+`</h4>
                    </td>
                    <td>
                        L. `+productPrice.value+`
                    </td>
                    <td>
                        `+brand.value+`
                    </td>
                    <td>
                        `+category.value+`
                    </td>
                    <td>
                        <div class="client-img-catalogo bg-img-tabla"
                            style="background-image: url(`+productImage.value+`)">
                        </div>
                    </td>
                    <td>
                        <div class="client-img-catalogo bg-img-tabla"
                            style="background-image: url(`+productImage2.value+`)">
                        </div>
                    </td>
                    <td>
                        <div class="client-img-catalogo bg-img-tabla"
                            style="background-image: url(`+productImage3.value+`)">
                        </div>
                    </td>
                    <td>
                        <p>`+productDescription.value+`</p>
                    </td>
                    <td>
                        `+productDate.value+`
                    </td>
                    <td>
                        L. `+productPriceSale.value+`
                    </td>
                    <td>
                        `+productState.value+`
                    </td>
                    <td>
                        <div class="actions">

                            <button id="openForm" onclick=openModificarModal("`+data.id+`")>
                                <img src="img_admin/boton-editar.png" alt="Agregar">
                            </button>
                    
                            <button id="openForm" onclick=openEliminarModal("`+data.id+`")>
                                <img src="img_admin/basura.png" alt="Eliminar">
                            </button>

                            <button id="openForm" onclick=openEliminarModal("`+data.id+`")>
                                <img src="img_admin/boton-agregar.png" alt="Añadir">
                            </button>
                        </div>
                    </td>
                </tr>
            </tbody>
            `
            alert('Producto creado exitosamente');
            category.value = "";
            brand.value = "";
            productName.value = "";
            productImage.value = "";
            productImage2.value = ""; 
            productImage3.value = ""; 
            productPrice.value = "";
            productPriceSale.value = "";
            productQuantity.value = "";
            productState.value = "";
            productDate.value = "";
            productDescription.value = "";
        })
        .catch(error => {
            alert('Error Creando Usuario'+ error);
        });
    }

    function leerProducto() {
            fetch(baseUrl + '/selectProductos', {
                method: 'GET',
                headers: {
                'Content-Type': 'application/json',
                },
            })
            .then(response => response.json())
            .then(data => {
                Tabla.innerHTML += ``;
                for(var i = 0; i < data.length; i++){
                    var idtb = ``;
                    if(data[i].carrusel == "No"){
                        idtb = `<button id="openForm" onclick="CambioCarrusel('`+data[i].id+`', 'Si')">
                                        <img src="img_admin/NoCarrusel.png" alt="Añadir">
                                    </button>`;
                    }else{
                        idtb = `<button id="openForm" onclick="CambioCarrusel('`+data[i].id+`', 'No')">
                                        <img src="img_admin/SiCarrusel.png" alt="Añadir">
                                    </button>`;
                    }
                    Tabla.innerHTML += `
                    <tbody>
                        <tr>
                            <td>`+data[i].id+`</td>
                            <td>
                                <h4>`+data[i].nombre+`</h4>
                            </td>
                            <td>
                                L. `+data[i].precio+`
                            </td>
                            <td>
                                `+data[i].marca+`
                            </td>
                            <td>
                                `+data[i].categoria+`
                            </td>
                            <td>
                                <div class="client-img-catalogo bg-img-tabla"
                                    style="background-image: url(`+data[i].imagen1+`)">
                                </div>
                            </td>
                            <td>
                                <div class="client-img-catalogo bg-img-tabla"
                                    style="background-image: url(`+data[i].imagen2+`)">
                                </div>
                            </td>
                            <td>
                                <div class="client-img-catalogo bg-img-tabla"
                                    style="background-image: url(`+data[i].imagen3+`)">
                                </div>
                            </td>
                            <td>
                                <p>`+data[i].descripcion+`</p>
                            </td>
                            <td>
                                `+data[i].fecha+`
                            </td>
                            <td>
                                L. `+data[i].precioventa+`
                            </td>
                            <td>
                                `+data[i].estado+`
                            </td>
                            <td>
                                <div class="actions">

                                    <button id="openForm" onclick=openModificarModal("`+data[i].id+`")>
                                        <img src="img_admin/boton-editar.png" alt="Agregar">
                                    </button>
                            
                                    <button id="openForm" onclick=openEliminarModal("`+data[i].id+`")>
                                        <img src="img_admin/basura.png" alt="Eliminar">
                                    </button>
                                    `+idtb+`
                                </div>
                            </td>
                        </tr>
                    </tbody>
                    `
                }
            })
            .catch(error => {
                alert(':('+error);
            });          
        }

        function CambioCarrusel(id, siono){
            fetch(baseUrl + '/ActualizarProducto3', {
                method: 'POST',
                headers: {
                'Content-Type': 'application/json',
                },
                body: JSON.stringify({ carrusel: siono,
                    id: id}),
            })
            .then(response => response.json())
            .then(data => {
                if(siono == "No"){
                    alert('Se ha eliminado del carrusel');
                }else{
                    alert('Se ha añadido al carrusel');
                }
                location.reload();
            })
            .catch(error => {
                alert('No se ha podido añadir al carrusel');
            });
        }

        function leerModificar(datas) {
            fetch(baseUrl + '/selectProducto', {
                method: 'POST',
                headers: {
                'Content-Type': 'application/json',
                },
                body: JSON.stringify({ id: datas}),
            })
            .then(response => response.json())
            .then(data => {
                console.log(data);
                category2.value = data.categoria;
                brand2.value = data.marca;
                productName2.value = data.nombre;
                productImage12.value = data.imagen1;
                productImage22.value = data.imagen2;
                productImage32.value = data.imagen3;
                productPrice2.value = data.precio;
                productQuantity2.value = data.cantidad;
                productPriceSale2.value = data.precioventa;
                productDate2.value = data.fecha;
                productDescription2.value = data.descripcion;
                productState2.value = data.estado;
            })
            .catch(error => {
                alert(':('+error);
            });
        }
</script>

</html>