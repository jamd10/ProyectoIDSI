<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1">
    <title>Panel de administración</title>
    <link rel="stylesheet" href="admincss/styledashboard.css">
    <link rel="stylesheet"
        href="https://maxst.icons8.com/vue-static/landings/line-awesome/line-awesome/1.3.0/css/line-awesome.min.css">


</head>

<body onload="leerServicio()">
    <input type="checkbox" id="menu-toggle">
    <div class="sidebar">
        <div class="side-header">
            <h3>G<span>rupo + Limpio</span></h3>
        </div>

        <div class="side-content">
            <div class="profile">
                <div class="profile-img bg-img" style="background-image: url(img_admin/3.jpeg)"></div>
                <h4>Inicio</h4>

            </div>

            <div class="side-menu">
                <ul>
                    <li>
                        <a href="index_admin.html">
                            <span class="las la-home"></span>
                            <small>Inicio</small>
                        </a>
                    </li>
                    <li>
                        <a href="productos_admin.html">
                            <span class="las la-shopping-cart"></span>
                            <small>Cátalogo</small>
                        </a>
                    </li>
                    <li>
                        <a href="servicios_admin.html">
                            <span class="las la-clipboard-list"></span>
                            <small>Servicios</small>
                        </a>
                    </li>
                    <li>
                        <a href="repartidor_admin.html">
                            <span class="las la-truck"></span>
                            <small>Repartidor</small>
                        </a>
                    </li>
                    <li>
                        <a href="pedidos_admin.html">
                            <span class="las la-clipboard-check"></span>
                            <small>Pedidos</small>
                        </a>
                    </li>
                    <li>
                        <a href="marcas_admin.html" class="active">
                            <span class="las la-store"></span>
                            <small>Marcas</small>
                        </a>
                    </li>
                    <li>
                        <a href="carrusel_admin.html">
                            <span class="las la-store"></span>
                            <small>Carrusel Inicial</small>
                        </a>
                    </li>
                    <li>
                        <a href="modificarcarrusel.html">
                            <span class="las la-store"></span>
                            <small>Pagina</small>
                        </a>
                    </li>
                    <li>
                        <a href="index.html">
                            <span class="las la-sign-out-alt"></span>
                            <small>Salir</small>
                        </a>
                    </li>

                </ul>
            </div>
        </div>
    </div>

    <div class="main-content">

        <header>
            <div class="header-content">
                <label for="menu-toggle">
                    <span class="las la-bars"></span>
                </label>
                <div class="header-menu">
                    <div class="user">
                        <div class="bg-img" style="background-image: url(img/3.jpeg)"></div>

                        <button id="CSAdmin" class="logout-link" > Cerrar Sesión </button>

                    </div>
                </div>
            </div>
        </header>


        <main>
            <div class="page-header">
                <h1>Marcas</h1>
                <small>Panel / Marcas</small>
            </div>
            <div class="page-content">
                <div class="records table-responsive">
                    <div class="record-header">
                        <div class="add">

                            <button id="openForm">Agregar</button>

                        </div>

                        <!-- <div class="browse">
                            <input type="search" placeholder="Buscar" class="record-search">
                            <select name="" id="">
                                <option value="">Estado</option>
                            </select>
                        </div> -->
                    </div>
                    <div>
                        <table class="product-table" id="TablaServicios">
                            <style>
                                body {
                                    font-family: Arial, sans-serif;
                                    margin: 0;
                                    padding: 0;
                                    display: flex;
                                    justify-content: center;
                                    align-items: center;

                                    background-color: #f5f5f5;
                                }

                                .product-table {
                                    width: 100%;
                                    border-collapse: collapse;
                                    margin-top: 20px;
                                }

                                .product-table th,
                                .product-table td {
                                    border: 1px solid #e7e7e7;
                                    padding: 8px;
                                    text-align: left;
                                }

                                .product-table th {
                                    background-color: #4bcf23c2;
                                }

                                .product-table h4 {
                                    margin: 0;
                                    font-size: 1em;
                                }

                                .product-table p {
                                    margin: 0;
                                    font-size: 0.8em;
                                }

                                .client-img-catalogo {
                                    width: 50px;
                                    height: 50px;
                                    background-size: cover;
                                }

                                .actions {
                                    display: flex;
                                }

                                .action-link {
                                    margin-right: 10px;
                                    text-decoration: none;
                                }
                            </style>
                            <thead>
                                <tr>
                                    <th>NOMBRE</th>
                                    <th>DESCRIPCION</th>
                                    <th>IMAGEN</th>
                                    <th>OPCIONES</th>
                                </tr>
                            </thead>
                            
                        </table>

                    </div>

                </div>

            </div>

        </main>

    </div>
    <div id="myModal" class="modal">
        <div class="modal-content">
            <span class="close">×</span>
            <h2>Agregar marca propia</h2>
            <hr>

            <div class="form-container">
                <div class="row">
                    <div class="column">
                        <label for="nombre">Nombre de la marca</label>
                        <input type="text" id="nombre" name="nombre">

                        <label for="imagen1">Imagen:</label>
                        <input type="text" id="imagen1" name="imagen1">

                        <label for="descripcion">Descripción:</label>
                        <textarea id="descripcion" name="descripcion"></textarea>
                    </div>
                </div>

                <div class="buttons">
                    <button id="AgregarAceptar">Aceptar</button>
                    <button id="cancelar">Cancelar</button>
                </div>
            </div>
        </div>
    </div>



    <div id="myModal_Modificar" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModificarModal()">×</span>
            <h2>Modificar</h2>
            <hr>

            <div class="form-container">
                <div class="row">
                    <div class="column">
                        <label for="nombre2">Nombre de la marca</label>
                        <input type="text" id="nombre2" name="nombre2">

                        <label for="imagen12">Imagen:</label>
                        <input type="text" id="imagen12" name="imagen12">

                        <label for="descripcion2">Descripción:</label>
                        <textarea id="descripcion2" name="descripcion2"></textarea>
                    </div>
                </div>

                <div class="buttons">
                    <button id="ModificarAceptar">Aceptar</button>
                    <button id="cancelar">Cancelar</button>
                </div>
            </div>
        </div>
    </div>

    <div id="myModal_Eliminar" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeEliminarModal()">×</span>
            <h2>Confirmación de Eliminación</h2>
            <hr>

            <p>¿Está seguro de que desea eliminar este cambio? Esta acción es permanente.</p>

            <div class="buttons">
                <button id="EliminarConfirmar">Confirmar</button>
                <button id="cancelarEliminar" onclick="closeEliminarModal()">Cancelar</button>
            </div>
        </div>
    </div>

    <script>
        function openEliminarModal(data) {
            var modalEliminar = document.getElementById('myModal_Eliminar');
            modalEliminar.style.display = 'block';
            localStorage["idS"] = data;
        }

        function closeEliminarModal() {
            var modalEliminar = document.getElementById('myModal_Eliminar');
            modalEliminar.style.display = 'none';
        }

        function eliminarCambio() {
            // Agrega aquí la lógica para eliminar el cambio
            // Puedes hacer una petición AJAX u otro método según tu aplicación
            alert('Cambio eliminado'); // Muestra una alerta como ejemplo
            closeEliminarModal(); // Cierra el modal después de confirmar
        }
    </script>


    <script src="producto.js"></script>


</body>

<script>
    function openModificarModal(data) {
        var modalModificar = document.getElementById('myModal_Modificar');
        modalModificar.style.display = 'block';
        leerModificar(data);
        localStorage["idS"] = data;
    }

    function closeModificarModal() {
        var modalModificar = document.getElementById('myModal_Modificar');
        modalModificar.style.display = 'none';
    }
</script>

<script>
    const getBtnLO = document.getElementById('CSAdmin');
    const Agregarbtn = document.getElementById('AgregarAceptar');
    const Modificarbtn = document.getElementById('ModificarAceptar');
    const Eliminarbtn = document.getElementById('EliminarConfirmar');
    const Tabla = document.getElementById('TablaServicios');

    const serviceName = document.getElementById('nombre');
    const serviceImage = document.getElementById('imagen1'); 
    const serviceDescription = document.getElementById('descripcion');

    const serviceName2 = document.getElementById('nombre2');
    const serviceImage12 = document.getElementById('imagen12'); 
    const serviceDescription2 = document.getElementById('descripcion2');

    getBtnLO.addEventListener('click', CerrarSesion);
    Agregarbtn.addEventListener('click', submitData);
    Modificarbtn.addEventListener('click', Actualizar);
    Eliminarbtn.addEventListener('click', Eliminar);

    const baseUrl = 'http://localhost:3001';

    function CerrarSesion() {
      fetch(baseUrl + '/logOut', {
        method: 'GET',
        headers: {
          'Content-Type': 'application/json',
        },
      })
        .then(response => response.json())
        .then(data => {
          if (data.msg == "log out") {
            alert('Se ha cerrrado sesion');
            localStorage.removeItem('Admin');
            localStorage.removeItem('correo');
            window.location.href = "index.html";
          } else {

          }
        })
        .catch(error => {
          alert('No se ha podido cerrar sesion');
        });
    }

    function Eliminar() {
        fetch(baseUrl + '/EliminarMarca', {
            method: 'POST',
            headers: {
            'Content-Type': 'application/json',
            },
            body: JSON.stringify({ nombre: localStorage["idS"],}),
        })
        .then(response => response.json())
        .then(data => {
            alert('La marca a sido eliminada');
            location.reload();
            var modalModificar = document.getElementById('myModal_Modificar');
            modalModificar.style.display = 'none';
        })
        .catch(error => {
            alert('No se ha podido eliminar la marca');
        });
    }

    function Actualizar() {
            fetch(baseUrl + '/ActualizarMarca', {
                method: 'POST',
                headers: {
                'Content-Type': 'application/json',
                },
                body: JSON.stringify({ nombre: serviceName2.value, imagen1: serviceImage12.value, 
                descripcion: serviceDescription2.value, id:localStorage["idS"]}),
            })
            .then(response => response.json())
            .then(data => {
                alert('La marca a sido actualizada');
                var modalModificar = document.getElementById('myModal_Modificar');
                modalModificar.style.display = 'none';
                location.reload();
                })
            .catch(error => {
                alert('No se ha podido actualizar su informacion');
            });
        }

    function submitData() {
        fetch(baseUrl + '/submitMarca', {
            method: 'POST',
            headers: {
            'Content-Type': 'application/json',
            },
            body: JSON.stringify({ nombre: serviceName.value, imagen1: serviceImage.value, 
            descripcion: serviceDescription.value, carrusel: "No", propia: "No"}),
        })
        .then(response => response.json())
        .then(data => {
            console.log(data);
            Tabla.innerHTML += `
            <tbody>
                <tr>
                    <td>
                        <h4>`+serviceName.value+`</h4>
                    </td>
                    <td>
                        <p>`+serviceDescription.value+`</p>
                    </td>
                    <td>
                        <div class="client-img-catalogo bg-img-tabla"
                            style="background-image: url(`+serviceImage.value+`)">
                        </div>
                    </td>
                    <td>
                        <div class="actions">
                            <button id="openForm" onclick=openModificarModal("`+data.id+`")>
                                <img src="img_admin/boton-editar.png" alt="Agregar">
                            </button>
                            <button id="openForm" onclick="CambioCarrusel('`+data.id+`', 'Si')">
                                <img src="img_admin/NoCarrusel2.png" alt="Añadir">
                            </button>
                            <button id="openForm" onclick="CambioPagina('`+data.id+`', 'Si')">
                                <img src="img_admin/NoPropia.png" alt="Añadir">
                            </button>
                            <button id="openForm" onclick=openEliminarModal("`+data.id+`")>
                                <img src="img_admin/basura.png" alt="Eliminar">
                            </button>
                            </a>
                        </div>
                    </td>
                </tr>
            </tbody>
            `
            alert('Marca creada exitosamente');
            serviceName.value = "";
            serviceImage.value = "";
            serviceDescription.value = "";
        })
        .catch(error => {
            alert('Error Creando Marca'+ error);
        });
    }

    function leerServicio() {
            fetch(baseUrl + '/selectMarcas', {
                method: 'GET',
                headers: {
                'Content-Type': 'application/json',
                },
            })
            .then(response => response.json())
            .then(data => {
                Tabla.innerHTML += ``;
                for(var i = 0; i < data.length; i++){
                    var idtb = ``;
                    if(data[i].carrusel == "No"){
                        idtb += `<button id="openForm" onclick="CambioCarrusel('`+data[i].id+`', 'Si')">
                                        <img src="img_admin/NoCarrusel2.png" alt="Añadir">
                                    </button>`;
                    }else{
                        idtb += `<button id="openForm" onclick="CambioCarrusel('`+data[i].id+`', 'No')">
                                        <img src="img_admin/SiCarrusel2.png" alt="Añadir">
                                    </button>`;
                    }
                    if(data[i].pagina == "No"){
                        idtb += `<button id="openForm" onclick="CambioPagina('`+data[i].id+`', 'Si')">
                                        <img src="img_admin/NoPropia.png" alt="Añadir">
                                    </button>`;
                    }else{
                        idtb += `<button id="openForm" onclick="CambioPagina('`+data[i].id+`', 'No')">
                                        <img src="img_admin/SiPropia.png" alt="Añadir">
                                    </button>`;
                    }
                    Tabla.innerHTML += `
                    <tbody>
                        <tr>
                            <td>
                                <h4>`+data[i].nombre+`</h4>
                            </td>

                            <td>
                                <p>`+data[i].descripcion+`</p>
                            </td>
                            <td>
                                <div class="client-img-catalogo bg-img-tabla"
                                    style="background-image: url(`+data[i].imagen1+`)">
                                </div>
                            </td>
                            <td>
                                <div class="actions">
                                    <button id="openForm" onclick=openModificarModal("`+data[i].id+`")>
                                        <img src="img_admin/boton-editar.png" alt="Agregar">
                                    </button>
                                    `+idtb+`
                                    <button id="openForm" onclick=openEliminarModal("`+data[i].id+`")>
                                        <img src="img_admin/basura.png" alt="Eliminar">
                                    </button>
                                    </a>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                    `
                }
            })
            .catch(error => {
                alert(':('+error);
            });          
        }

        function CambioCarrusel(id, siono){
            fetch(baseUrl + '/ActualizarMarca2', {
                method: 'POST',
                headers: {
                'Content-Type': 'application/json',
                },
                body: JSON.stringify({ carrusel: siono,
                    id: id}),
            })
            .then(response => response.json())
            .then(data => {
                if(siono == "No"){
                    alert('Se ha eliminado del carrusel');
                }else{
                    alert('Se ha añadido al carrusel');
                }
                location.reload();
            })
            .catch(error => {
                alert('No se ha podido añadir al carrusel');
            });
        }

        function CambioPagina(id, siono){
            fetch(baseUrl + '/ActualizarMarca3', {
                method: 'POST',
                headers: {
                'Content-Type': 'application/json',
                },
                body: JSON.stringify({ pagina: siono,
                    id: id}),
            })
            .then(response => response.json())
            .then(data => {
                if(siono == "No"){
                    alert('Se ha eliminado de marcas propias');
                }else{
                    alert('Se ha añadido a marcas propias');
                }
                location.reload();
            })
            .catch(error => {
                alert('No se ha podido añadir al carrusel');
            });
        }

        function leerModificar(datas) {
            fetch(baseUrl + '/selectMarca', {
                method: 'POST',
                headers: {
                'Content-Type': 'application/json',
                },
                body: JSON.stringify({ id: datas}),
            })
            .then(response => response.json())
            .then(data => {
                serviceName2.value = data.nombre;
                serviceImage12.value = data.imagen1;
                serviceDescription2.value = data.descripcion;
            })
            .catch(error => {
                alert(':('+error);
            });
        }
</script>


</html>