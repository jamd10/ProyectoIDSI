<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1">
    <title>Panel de administración</title>
    <link rel="stylesheet" href="admincss/styledashboard.css">
    <link rel="stylesheet"
        href="https://maxst.icons8.com/vue-static/landings/line-awesome/line-awesome/1.3.0/css/line-awesome.min.css">


</head>

<body onload="leerServicio()">
    <input type="checkbox" id="menu-toggle">
    <div class="sidebar">
        <div class="side-header">
            <h3>G<span>rupo + Limpio</span></h3>
        </div>

        <div class="side-content">
            <div class="profile">
                <div class="profile-img bg-img" style="background-image: url(img_admin/3.jpeg)"></div>
                <h4>Inicio</h4>

            </div>

            <div class="side-menu">
                <ul>
                    <li>
                        <a href="index_admin.html">
                            <span class="las la-home"></span>
                            <small>Inicio</small>
                        </a>
                    </li>
                    <li>
                        <a href="productos_admin.html">
                            <span class="las la-shopping-cart"></span>
                            <small>Cátalogo</small>
                        </a>
                    </li>
                    <li>
                        <a href="servicios_admin.html" class="active">
                            <span class="las la-clipboard-list"></span>
                            <small>Servicios</small>
                        </a>
                    </li>
                    <li>
                        <a href="repartidor_admin.html">
                            <span class="las la-truck"></span>
                            <small>Repartidor</small>
                        </a>
                    </li>
                    <li>
                        <a href="pedidos_admin.html">
                            <span class="las la-clipboard-check"></span>
                            <small>Pedidos</small>
                        </a>
                    </li>
                    <li>
                        <a href="marcas_admin.html">
                            <span class="las la-store"></span>
                            <small>Marcas</small>
                        </a>
                    </li>
                    <li>
                        <a href="carrusel_admin.html">
                            <span class="lab la-slideshare"></span>
                            <small>Carrusel Inicial</small>
                        </a>
                    </li>
                    <li>
                        <a href="modificarcarrusel.html">
                            <span class="las la-tv"></span>
                            <small>Pagina</small>
                        </a>
                    </li>
                    <li>
                        <a href="index.html">
                            <span class="las la-sign-out-alt"></span>
                            <small>Salir</small>
                        </a>
                    </li>

                </ul>
            </div>
        </div>
    </div>

    <div class="main-content">

        <header>
            <div class="header-content">
                <label for="menu-toggle">
                    <span class="las la-bars"></span>
                </label>
                <div class="header-menu">
                    <div class="user">
                        <div class="bg-img" style="background-image: url(img/3.jpeg)"></div>

                        <button id="CSAdmin" class="logout-link" > Cerrar Sesión </button>

                    </div>
                </div>
            </div>
        </header>


        <main>
            <div class="page-header">
                <h1>Servicios</h1>
                <small>Panel / Servicios</small>
            </div>
            <div class="page-content">
                <div class="records table-responsive">
                    <div class="record-header">
                        <div class="add">

                            <button id="openForm">Agregar</button>
                            

                        </div>

                        <div class="browse">
                            <input type="search" placeholder="Buscar" class="record-search">
                            <button onclick="searchRecords()">Buscar</button>
                        </div>
                    </div>
                    <div>
                        <table class="product-table" id="TablaServicios">
                            <style>
                                body {
                                    font-family: Arial, sans-serif;
                                    margin: 0;
                                    padding: 0;
                                    display: flex;
                                    justify-content: center;
                                    align-items: center;

                                    background-color: #f5f5f5;
                                }

                                .product-table {
                                    width: 100%;
                                    border-collapse: collapse;
                                    margin-top: 20px;
                                }

                                .product-table th,
                                .product-table td {
                                    border: 1px solid #e7e7e7;
                                    padding: 8px;
                                    text-align: left;
                                }

                                .product-table th {
                                    background-color: #4bcf23c2;
                                }

                                .product-table h4 {
                                    margin: 0;
                                    font-size: 1em;
                                }

                                .product-table p {
                                    margin: 0;
                                    font-size: 0.8em;
                                }

                                .client-img-catalogo {
                                    width: 50px;
                                    height: 50px;
                                    background-size: cover;
                                }

                                .actions {
                                    display: flex;
                                }

                                .action-link {
                                    margin-right: 10px;
                                    text-decoration: none;
                                }
                            </style>
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>NOMBRE</th>
                                    <th>DESCRIPCIÓN DE SERVICIO</th>
                                    <th>BENEFICIOS </th>
                                    <th>CARACTERÍSTICAS</th>
                                    <th>IMAGEN 1</th>
                                    <th>IMAGEN 2</th>
                                    <th>IMAGEN 3</th>
                                    <th>ESTADO</th>
                                    <th>OPCIONES</th>
                                </tr>
                            </thead>
                            
                        </table>

                    </div>

                </div>

            </div>

        </main>

    </div>
    <div id="myModal" class="modal">
        <div class="modal-content">
            <span class="close">×</span>
            <h2>Agregar Servicio</h2>
            <hr>

            <div class="form-container">
                <div class="row">
                    <div class="column">
                        <label for="nombre">Nombre del servicio:</label>
                        <input type="text" id="nombre" name="nombre">

                        <label for="imagen1">Imagen 1:</label>
                        <input type="text" id="imagen1" name="imagen1">

                        <label for="imagen2">Imagen 2:</label>
                        <input type="text" id="imagen2" name="imagen2">

                        <label for="imagen3">Imagen 3:</label>
                        <input type="text" id="imagen3" name="imagen3">
                    </div>

                    <div class="column">
                        <label for="descripcion">Descripción:</label>
                        <textarea id="descripcion" name="descripcion"></textarea>
      
                        <label for="beneficios">Beneficios:</label>
                        <textarea id="beneficios" name="beneficios"></textarea>

                        <label for="caracteristicas">Características:</label>
                        <textarea id="caracteristicas" name="caracteristicas"></textarea>

                        <label for="estado">Estado:</label>
                        <select id="estado" name="estado">
                            <option value="Activo">Activo</option>
                            <option value="Desactivo">Desactivo</option>
                        </select>
                    </div>
                </div>

                <div class="buttons">
                    <button id="AgregarAceptar">Aceptar</button>
                    <button id="cancelar">Cancelar</button>
                </div>
            </div>
        </div>
    </div>



    <div id="myModal_Modificar" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModificarModal()">×</span>
            <h2>Modificar</h2>
            <hr>

            <div class="form-container">
                <div class="row">
                    <div class="column">
                        <label for="nombre2">Nombre del servicio:</label>
                        <input type="text" id="nombre2" name="nombre">

                        <label for="imagen12">Imagen 1:</label>
                        <input type="text" id="imagen12" name="imagen1">

                        <label for="imagen22">Imagen 2:</label>
                        <input type="text" id="imagen22" name="imagen22">

                        <label for="imagen32">Imagen 3:</label>
                        <input type="text" id="imagen32" name="imagen32">
                    </div>

                    <div class="column">
                        <label for="descripcion2">Descripción:</label>
                        <textarea id="descripcion2" name="descripcion2"></textarea>
      
                        <label for="beneficios2">Beneficios:</label>
                        <textarea type="text" id="beneficios2" name="beneficios2"></textarea>

                        <label for="caracteristicas2">Características:</label>
                        <textarea type="text" id="caracteristicas2" name="caracteristicas2"></textarea>

                        <label for="estado2">Estado:</label>
                        <select id="estado2" name="estado2">
                            <option value="Activo">Activo</option>
                            <option value="Desactivo">Desactivo</option>
                        </select>
                    </div>
                </div>

                <div class="buttons">
                    <button id="ModificarAceptar">Aceptar</button>
                    <button id="cancelar">Cancelar</button>
                </div>
            </div>
        </div>
    </div>

    <div id="myModal_Eliminar" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeEliminarModal()">×</span>
            <h2>Confirmación de Eliminación</h2>
            <hr>

            <p>¿Está seguro de que desea eliminar este cambio? Esta acción es permanente.</p>

            <div class="buttons">
                <button id="EliminarConfirmar">Confirmar</button>
                <button id="cancelarEliminar" onclick="closeEliminarModal()">Cancelar</button>
            </div>
        </div>
    </div>

    <script>
        function openEliminarModal(data) {
            var modalEliminar = document.getElementById('myModal_Eliminar');
            modalEliminar.style.display = 'block';
            localStorage["idS"] = data;
        }

        function closeEliminarModal() {
            var modalEliminar = document.getElementById('myModal_Eliminar');
            modalEliminar.style.display = 'none';
        }

        function eliminarCambio() {
            // Agrega aquí la lógica para eliminar el cambio
            // Puedes hacer una petición AJAX u otro método según tu aplicación
            alert('Cambio eliminado'); // Muestra una alerta como ejemplo
            closeEliminarModal(); // Cierra el modal después de confirmar
        }
    </script>


    <script src="producto.js"></script>


</body>

<script>
    function openModificarModal(data) {
        var modalModificar = document.getElementById('myModal_Modificar');
        modalModificar.style.display = 'block';
        leerModificar(data);
        localStorage["idS"] = data;
    }

    function closeModificarModal() {
        var modalModificar = document.getElementById('myModal_Modificar');
        modalModificar.style.display = 'none';
    }
</script>

<script>
    const getBtnLO = document.getElementById('CSAdmin');
    const Agregarbtn = document.getElementById('AgregarAceptar');
    const Modificarbtn = document.getElementById('ModificarAceptar');
    const Eliminarbtn = document.getElementById('EliminarConfirmar');
    const Tabla = document.getElementById('TablaServicios');

    const serviceName = document.getElementById('nombre');
    const serviceImage = document.getElementById('imagen1'); 
    const serviceImage2 = document.getElementById('imagen2'); 
    const serviceImage3 = document.getElementById('imagen3'); 
    const serviceState = document.getElementById('estado');
    const serviceDescription = document.getElementById('descripcion');
    const serviceBenefit = document.getElementById('beneficios');
    const serviceCaracteristics = document.getElementById('caracteristicas');

    const serviceName2 = document.getElementById('nombre2');
    const serviceImage12 = document.getElementById('imagen12'); 
    const serviceImage22 = document.getElementById('imagen22'); 
    const serviceImage32 = document.getElementById('imagen32'); 
    const serviceState2 = document.getElementById('estado2');
    const serviceDescription2 = document.getElementById('descripcion2');
    const serviceBenefit2 = document.getElementById('beneficios2');
    const serviceCaracteristics2 = document.getElementById('caracteristicas2');

    getBtnLO.addEventListener('click', CerrarSesion);
    Agregarbtn.addEventListener('click', PreSubmitData);
    Modificarbtn.addEventListener('click', PreActualizar);
    Eliminarbtn.addEventListener('click', Eliminar);

    const baseUrl = 'https://grupolimpio-api.onrender.com';

    function CerrarSesion() {
      fetch(baseUrl + '/logOut', {
        method: 'GET',
        headers: {
          'Content-Type': 'application/json',
        },
      })
        .then(response => response.json())
        .then(data => {
          if (data.msg == "log out") {
            alert('Se ha cerrrado sesion');
            localStorage.removeItem('Admin');
            localStorage.removeItem('correo');
            window.location.href = "index.html";
          } else {

          }
        })
        .catch(error => {
          alert('No se ha podido cerrar sesion');
        });
    }

    function Eliminar() {
        fetch(baseUrl + '/EliminarServicio', {
            method: 'POST',
            headers: {
            'Content-Type': 'application/json',
            },
            body: JSON.stringify({ nombre: localStorage["idS"],}),
        })
        .then(response => response.json())
        .then(data => {
            alert('El servicio a sido eliminado');
            location.reload();
            var modalModificar = document.getElementById('myModal_Modificar');
            modalModificar.style.display = 'none';
        })
        .catch(error => {
            alert('No se ha podido eliminar el servicio');
        });
    }

    function Actualizar() {
            fetch(baseUrl + '/ActualizarServicio', {
                method: 'POST',
                headers: {
                'Content-Type': 'application/json',
                },
                body: JSON.stringify({ nombre: serviceName2.value, imagen1: serviceImage12.value, 
                    imagen2: serviceImage22.value, imagen3: serviceImage32.value, beneficio: serviceBenefit2.value,
                    estado: serviceState2.value, descripcion: serviceDescription2.value, caracteristicas: serviceCaracteristics2.value,
                    id: localStorage["idS"]}),
            })
            .then(response => response.json())
            .then(data => {
                alert('El servicio a sido actualizado');
                var modalModificar = document.getElementById('myModal_Modificar');
                modalModificar.style.display = 'none';
                location.reload();
                })
            .catch(error => {
                alert('No se ha podido actualizar su informacion');
            });
        }

    function PreSubmitData(){
        if(serviceName.value == ""){
            alert("Ingrese el nombre del servicio");
        }
        else if(serviceImage.value == ""){
            alert("Ingrese una imagen en el campo imagen1");
        }
        else if(serviceImage2.value == ""){
            alert("Ingrese una imagen en el campo imagen2");
        }
        else if(serviceImage3.value == ""){
            alert("Ingrese una imagen en el campo imagen3");
        }
        else if(serviceState.value == ""){
            alert("Seleccione un estado");
        }
        else if(serviceDescription.value == ""){
            alert("Ingrese la descripcion del servicio");
        }
        else if(serviceBenefit.value == ""){
            alert("Ingrese el beneficio del servicio");
        }
        else if(serviceCaracteristics.value == ""){
            alert("Ingrese las caracteristicas del servicio");
        }
        else{
            submitData();
        }
    }

    function PreActualizar(){
        if(serviceName2.value == ""){
            alert("Ingrese el nombre del servicio");
        }
        else if(serviceImage12.value == ""){
            alert("Ingrese una imagen en el campo imagen1");
        }
        else if(serviceImage22.value == ""){
            alert("Ingrese una imagen en el campo imagen2");
        }
        else if(serviceImage32.value == ""){
            alert("Ingrese una imagen en el campo imagen3");
        }
        else if(serviceState2.value == ""){
            alert("Seleccione un estado");
        }
        else if(serviceDescription2.value == ""){
            alert("Ingrese la descripcion del servicio");
        }
        else if(serviceBenefit2.value == ""){
            alert("Ingrese el beneficio del servicio");
        }
        else if(serviceCaracteristics2.value == ""){
            alert("Ingrese las caracteristicas del servicio");
        }
        else{
            Actualizar();
        }
    }

    function submitData() {
        fetch(baseUrl + '/submitServicio', {
            method: 'POST',
            headers: {
            'Content-Type': 'application/json',
            },
            body: JSON.stringify({ nombre: serviceName.value, imagen1: serviceImage.value, id: '',
                imagen2: serviceImage2.value, imagen3: serviceImage3.value, beneficio: serviceBenefit.value,
                caracteristicas: serviceCaracteristics.value, descripcion: serviceDescription.value, estado: serviceState.value}),
        })
        .then(response => response.json())
        .then(data => {
            console.log(data);
            Tabla.innerHTML += `
            <tbody>
                <tr>
                    <td>`+data.id+`</td>
                    <td>
                        <h4>`+serviceName.value+`</h4>
                    </td>

                    <td>
                        <p>`+serviceDescription.value+`</p>
                    </td>
                    <td>
                        <p>`+serviceBenefit.value+`</p>
                    </td>
                    
                    <td>
                        <p>`+serviceCaracteristics.value+`</p>
                    </td>
                    <td>
                        <div class="client-img-catalogo bg-img-tabla"
                            style="background-image: url(`+serviceImage.value+`)">
                        </div>
                    </td>
                    <td>
                        <div class="client-img-catalogo bg-img-tabla"
                            style="background-image: url(`+serviceImage2.value+`)">
                        </div>
                    </td>
                    <td>
                        <div class="client-img-catalogo bg-img-tabla"
                            style="background-image: url(`+serviceImage3.value+`)">
                        </div>
                    </td>
                    <td>
                        `+serviceState.value+`
                    </td>
                    <td>
                        <div class="actions">
                            <button id="openForm" onclick=openModificarModal("`+data.id+`")>
                                <img src="img_admin/boton-editar.png" alt="Agregar">
                            </button>

                            <button id="openForm" onclick=openEliminarModal("`+data.id+`")>
                                <img src="img_admin/basura.png" alt="Eliminar">
                            </button>
                            </a>
                        </div>
                    </td>
                </tr>
            </tbody>
            `
            alert('Servicio creado exitosamente');
            serviceName.value = "";
            serviceImage.value = "";
            serviceImage2.value = ""; 
            serviceImage3.value = ""; 
            serviceState.value = "";
            serviceDescription.value = "";
            serviceBenefit.value = "";
            serviceCaracteristics.value = "";
        })
        .catch(error => {
            alert('Error Creando Servicio'+ error);
        });
    }

    function leerServicio() {
            fetch(baseUrl + '/selectServicios', {
                method: 'GET',
                headers: {
                'Content-Type': 'application/json',
                },
            })
            .then(response => response.json())
            .then(data => {
                Tabla.innerHTML += ``;
                for(var i = 0; i < data.length; i++){
                    var idtb = data[i].id;
                    Tabla.innerHTML += `
                    <tbody>
                        <tr>
                            <td>`+data[i].id+`</td>
                            <td>
                                <h4>`+data[i].nombre+`</h4>
                            </td>

                            <td>
                                <p>`+data[i].descripcion+`</p>
                            </td>
                            <td>
                                <p>`+data[i].beneficio+`</p>
                            </td>
                            
                            <td>
                                <p>`+data[i].caracteristicas+`</p>
                            </td>
                            <td>
                                <div class="client-img-catalogo bg-img-tabla"
                                    style="background-image: url(`+data[i].imagen1+`)">
                                </div>
                            </td>
                            <td>
                                <div class="client-img-catalogo bg-img-tabla"
                                    style="background-image: url(`+data[i].imagen2+`)">
                                </div>
                            </td>
                            <td>
                                <div class="client-img-catalogo bg-img-tabla"
                                    style="background-image: url(`+data[i].imagen3+`)">
                                </div>
                            </td>
                            <td>
                                `+data[i].estado+`
                            </td>
                            <td>
                                <div class="actions">
                                    <button id="openForm" onclick=openModificarModal("`+data[i].id+`")>
                                        <img src="img_admin/boton-editar.png" alt="Agregar">
                                    </button>

                                    <button id="openForm" onclick=openEliminarModal("`+data[i].id+`")>
                                        <img src="img_admin/basura.png" alt="Eliminar">
                                    </button>
                                    </a>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                    `
                }
            })
            .catch(error => {
                alert(':('+error);
            });          
        }

        function searchRecords() {
            var searchTerm = document.querySelector('.record-search').value.toLowerCase();
            var rows = Tabla.getElementsByTagName('tr');

            for (var i = 0; i < rows.length; i++) {
                var cells = rows[i].getElementsByTagName('td');
                var found = false;
                for (var j = 0; j < cells.length; j++) {
                    var cellValue = cells[j].textContent || cells[j].innerText;
                    if (cellValue.toLowerCase().indexOf(searchTerm) > -1) {
                        found = true;
                        break;
                    }
                }
                if (found) {
                    rows[i].style.display = '';
                } else {
                    rows[i].style.display = 'none';
                }
                if (i == 0) {
                    rows[i].style.display = '';
                }
            }
        }

        function leerModificar(datas) {
            fetch(baseUrl + '/selectServicio', {
                method: 'POST',
                headers: {
                'Content-Type': 'application/json',
                },
                body: JSON.stringify({ id: datas}),
            })
            .then(response => response.json())
            .then(data => {
                console.log(data);
                serviceName2.value = data.nombre;
                serviceImage12.value = data.imagen1;
                serviceImage22.value = data.imagen2;
                serviceImage32.value = data.imagen3;
                serviceDescription2.value = data.descripcion;
                serviceBenefit2.value = data.beneficio;
                serviceCaracteristics2.value = data.caracteristicas;
                serviceState2.value = data.estado;
            })
            .catch(error => {
                alert(':('+error);
            });
        }
</script>


</html>