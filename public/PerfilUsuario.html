<!doctype html>
<html lang="es">

<head>
  <link href="PerfilUsuario.css" rel="stylesheet" type="text/css" />
  <title>Grupo + Limpio</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Enlaces de Bootstrap y jQuery -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css">
  <!-- Otros enlaces -->
  <link rel="stylesheet" href="menu.css">
  <link rel="stylesheet" href="carrusel.css">
  <link rel="stylesheet" href="cards.css">
  <link rel="stylesheet" href="footer.css">
  <link rel="stylesheet" href="destacados.css">
  <link rel="stylesheet" href="marcas.css">
  <link rel="stylesheet" href="info.css">
  <link rel="stylesheet" href="btn.css">
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
  <!-- FONTS -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@100;200;300;400;500;600;700&display=swap"
    rel="stylesheet">
  <script src="https://unpkg.com/ionicons@4.5.10-0/dist/ionicons.js"></script>
  <link rel="icon" href="img/logo1.png">
</head>


<body onload="CargarDatos()">
  <div id="loader" class="loader">
    <div class="spinner"></div>
  </div>
  <header class="bg-white">
    <nav class="flex justify-between items-center w-[92%]  mx-auto">
      <div>
        <a href="index.html">
          <img class="w-32 cursor-pointer" src="img/logo.png" alt="Logo">
        </a>
      </div>
      <div
        class="nav-links duration-500 md:static absolute bg-white md:min-h-fit min-h-[60vh] left-0 top-[-100%] md:w-auto w-full flex items-center px-5">
        <ul class="flex md:flex-row flex-col md:items-center md:gap-[4vw] gap-8">
          <li>
            <a class="menu-link" href="index.html">Inicio</a>
          </li>
          <li>
            <a class="menu-link" href="catalogo.html">Catálogo</a>
          </li>
          <li>
            <a class="menu-link" href="about.html">Sobre Nosotros</a>
          </li>
          <li>
            <a class="menu-link" href="#">
              <ion-icon name="cart" class="text-black text-xl"></ion-icon>Carrito
            </a>
          </li>

          <li class="search-container">
            <form action="index.html" method="get">
              <input class="search-bar" type="text" placeholder="Buscar...">
              <button type="submit" class="search-button"><ion-icon name="search"
                  class="search-icon"></ion-icon></button>
            </form>
          </li>
        </ul>
      </div>
      <div class="flex items-center gap-6">
        <a class="bg-[#23c01e] text-white px-5 py-2 rounded-full hover:bg-[#1abc9c]" href="main.html">Iniciar Sesion</a>
        <ion-icon onclick="onToggleMenu(this)" name="menu" class="text-3xl cursor-pointer md:hidden"></ion-icon>
      </div>
    </nav>
  </header>


  <main>
    <section>
      <!-- Contenido del submenú -->
      <div>
        <nav class="my-submenu-nav">
          <a href="catalogo.html?flag=Baños">Baños</a>
          <a href="catalogo.html?flag=Lavandería">Lavandería</a>
          <a href="catalogo.html?flag=Herramientas de Limpieza">Herramientas de Limpieza</a>
          <a href="catalogo.html?flag=Bioseguridad">Bioseguridad</a>
          <a href="catalogo.html?flag=Desinfectante">Desinfectante</a>
          <a href="catalogo.html?flag=Cuidado Personal">Cuidado Personal</a>
          <a href="catalogo.html?flag=Productos Plásticos">Productos Plásticos</a>
          <div class="animation start-home"></div>
        </nav>
      </div>
    </section>
    <section>
      <div class="PUDiv">
        <div class="TituloDiv">
          <img src="./imagenusario.png" class="ImgU" alt="imagen" />
          <span class="Titulo">Perfil de Cliente</span>
        </div>
        <div>
          <div id="ContenidoPU" class="ConPU">
            <nav>
              <div class="navpu" id="nav-tab" role="tablist">
                <button class="btnIP" id="navbtnIP" data-bs-toggle="tab" data-bs-target="#nav-home" type="button"
                  role="tab" aria-controls="nav-IP" aria-selected="true">Informacion Personal</button>
                <button class="btnMD" id="navbtnMD" data-bs-toggle="tab" data-bs-target="#nav-profile" type="button"
                  role="tab" aria-controls="nav-MD" aria-selected="false">Mi Direccion</button>
                <button class="btnS" id="navbtnS" data-bs-toggle="tab" data-bs-target="#nav-disabled" type="button"
                  role="tab" aria-controls="nav-S" aria-selected="false">Seguridad</button>
                <button class="btnLO" id="navbtnLO" data-bs-toggle="tab" data-bs-target="#nav-disabled" type="button"
                  role="tab" aria-controls="nav-S" aria-selected="false">Cerrar Sesion</button>
              </div>
            </nav>
            <div id="IDDivIP" class="DivIP">
              <link href="InfoPersonal.css" rel="stylesheet" type="text/css" />
              <div class="SubDivIp2">
                <span>Informacion Personal</span>
              </div>
              <div class="SubDivIp">
                <span>Nombre</span>
                <span>Apellido</span>
                <span></span>
              </div>
              <div class="SubDivIp3">
                <input id="NombreInput" class="InputIP" type="text" onkeyup="validate();"/>
                <input id="ApellidoInput" class="InputIP" type="text" onkeyup="validate2();"/>
                <span></span>
              </div>
              <div class="SubDivIp">
                <span>Correo Electronico</span>
                <span>Numero de Telefono</span>
                <span></span>
              </div>
              <div class="SubDivIp3">
                <input id="CorreoInput" class="InputIP" placeholder="ejemplo@correo.com" type="text" style="opacity: 0.5;" disabled/>
                <input id="TelefonoInput" class="InputIP" placeholder="XXXXXXXX" type="text" onkeyup="validate4();" maxlength = "8"/>
                <span></span>
              </div>
              <div class="SubDivIp">
                <span>Fecha de Nacimiento</span>
                <span>Numero de Identidad</span>
                <span></span>
              </div>
              <div class="SubDivIp3">
                <input id="NacimientoInput" class="InputIP" placeholder="DD/MM/AAAA" type="date" pattern="\d{2}/\d{2}/\d{4}"/>
                <input id="IdentidadInput" class="InputIP" placeholder="XXXXXXXXXXXXX" type="text" onkeyup="validate3();" maxlength = "13"/>
                <span></span>
              </div>
              <div class="SubDivIp">
                <span>Genero</span>
                <span></span>
                <span></span>
              </div>
              <div class="SubDivIp3">
                <select id="GeneroSelect" class="InputIP">
                  <option value="masculino">Masculino</option>
                  <option value="femenino">Femenino</option>
                </select>
                <span></span>
                <span></span>
              </div>
              <div class="SubDivIpBtn">
                <button id="Guardarbtn" class="BtnIpEditar"> Guardar Cambios </button>
              </div>
            </div>

            <div id="IDDivMD" class="DivMD">
              <link href="MiDireccion.css" rel="stylesheet" type="text/css" />
              <div class="SubDivMD">
                <span>Mi Direccion</span>
              </div>
              <div class="SubDivMD2">
                <span>Ciudad</span>
                <span>Direccion</span>
                <span></span>
              </div>
              <div class="SubDivMD3">
                <input id="CiudadInput" class="InputMD" type="text" onkeyup="validate5();"/>
                <input id="DireccionInput" class="InputMD" type="text" />
                <span></span>
              </div>
              <div class="SubDivMdBtn">
                <button id="Guardarbtn2" class="BtnMdEditar">Guardar Cambios</button>
              </div>
            </div>

            <div id="IDDivS2" class="DivS">
              <link href="Seguridad.css" rel="stylesheet" type="text/css" />
              <div class="SubDivS">
                <span>Seguridad</span>
              </div>
              <div class="SubDivSBtn">
                <button id="BtnSEditar2" class="BtnSEditar">Cambiar Contraseña</button>
              </div>
            </div>

            <div id="IDDivS" class="DivS2">
              <link href="Seguridad.css" rel="stylesheet" type="text/css" />
              <div class="SubDivS">
                <span>Seguridad</span>
              </div>
              <div class="SubDivS2">
                <span>Ingrese la contraseña actual</span>
              </div>
              <div class="SubDivS3">
                <input id="C1Input" class="InputS" type="password" />
              </div>
              <div class="checkboxS">
                <input type="checkbox" onclick="mostrarcontra1()">Mostrar</input>
              </div>
              <div class="SubDivS2">
                <span>Ingrese la contraseña nueva</span>
              </div>
              <div class="SubDivS3">
                <input id="C2Input" class="InputS" type="password" />
              </div>
              <div class="checkboxS">
                <input type="checkbox" onclick="mostrarcontra2()">Mostrar</input>
              </div>
              <div class="SubDivSBtn">
                <button id="BtnSEditar1" class="BtnSEditar">Guardar Contraseña</button>
              </div>
            </div>
          </div>
        </div>
      </div>
      <section>
        <button id="scrollToTopBtn" onclick="scrollToTop()">
          <i class="fa fa-arrow-up"></i>
        </button>
      </section>
    </section>

    <script>
      const boton1 = document.getElementById('navbtnIP');
      const boton2 = document.getElementById('navbtnMD');
      const boton3 = document.getElementById('navbtnS');
      const boton4 = document.getElementById('BtnSEditar2');
      const boton5 = document.getElementById('BtnSEditar1');
      const div1 = document.getElementById('IDDivIP');
      const div2 = document.getElementById('IDDivMD');
      const div3 = document.getElementById('IDDivS');
      const div4 = document.getElementById('IDDivS2');

      function changeContent1() {
        div1.style.display = "block"
        div2.style.display = "none"
        div3.style.display = "none"
        div4.style.display = "none"
      }

      function changeContent2() {
        div1.style.display = "none"
        div2.style.display = "block"
        div3.style.display = "none"
        div4.style.display = "none"
      }

      function changeContent3() {
        div1.style.display = "none"
        div2.style.display = "none"
        div3.style.display = "none"
        div4.style.display = "block"
      }

      function changeContent4() {
        div4.style.display = "none"
        div3.style.display = "block"
      }

      function changeContent5() {
        div3.style.display = "none"
        div4.style.display = "block"
      }

      function mostrarcontra1() {
        var x = document.getElementById("C1Input");
        if (x.type === "password") {
          x.type = "text";
        } else {
          x.type = "password";
        }
      }

      function mostrarcontra2() {
        var x = document.getElementById("C2Input");
        if (x.type === "password") {
          x.type = "text";
        } else {
          x.type = "password";
        }
      }

      boton1.addEventListener('click', changeContent1);
      boton2.addEventListener('click', changeContent2);
      boton3.addEventListener('click', changeContent3);
      boton4.addEventListener('click', changeContent4);
      boton5.addEventListener('click', changeContent5);
    </script>


  </main>

  <footer>
    <section class="footer">
        <div class="footer-row">
            <div class="footer-col">
                <h4>Conocenos</h4>
                <ul class="links">
                    <li><a href="#">Acerca de Nosotros</a></li>
                    <li><a href="#">Historia</a></li>
                    <li><a href="#">Marcas</a></li>
                    <li><a href="#">Catálogo en línea</a></li>
                    <li><a href="#">Promociones</a></li>
                </ul>
            </div>

            <div class="footer-col">
                <h4>Información </h4>
                <ul class="links">
                    <li><a href="#">Formas de pago</a></li>
                    <li><a href="#">Productos nuevos</a></li>
                    <li><a href="PreguntasFrecCliente.html">Preguntas frecuentes</a></li>
                </ul>
            </div>

            <div class="footer-col">
                <h4>Legal</h4>
                <ul class="links">
                    <li><a href="Politicas.html">Politicas de seguridad</a></li>
                    <li><a href="#">Envios</a></li>
                    <li><a href="#">Pagos</a></li>
                </ul>
            </div>

            <div class="footer-col">
                <h4>Contacto</h4>
                <ul class="links">
                    <li><a href="Contactarse.html">Contactar</a></li>
                </ul>
            </div>
        </div>
        <div class="footer-row" style="display: flex; align-items: center; justify-content: center;">
            <div class="footer-col" style="text-align: center; margin-top: 20px; color: #fff;">
                Derechos reservados © 2023 | Grupo + Limpio
                <div class="icons">
                    <a href="https://www.facebook.com" target="_blank"><i class="fab fa-facebook-f"></i></a>
                    <a href="https://www.tiktok.com" target="_blank"><i class="fab fa-tiktok"></i></a>
                    <a href="https://www.whatsapp.com" target="_blank"><i class="fab fa-whatsapp"></i></a>
                </div>
            </div>
        </div>
    </section>
</footer>

  <script>
    const getBtnC = document.getElementById('BtnSEditar1');
    const getBtn = document.getElementById('Guardarbtn');
    const getBtn2 = document.getElementById('Guardarbtn2');
    const getBtnLO = document.getElementById('navbtnLO');
    const getNombre = document.getElementById("NombreInput");
    const getApellido =  document.getElementById("ApellidoInput");
    const getCorreo =  document.getElementById("CorreoInput");
    const getTelefono =  document.getElementById("TelefonoInput");
    const getNacimiento =  document.getElementById("NacimientoInput");
    const getId =  document.getElementById("IdentidadInput");
    const getGenero =  document.getElementById("GeneroSelect");
    const getCiudad =  document.getElementById("CiudadInput");
    const getDireccion =  document.getElementById("DireccionInput");
    const getNuevaContra = document.getElementById("C2Input");

    getBtn.addEventListener('click', validar3);
    getBtn2.addEventListener('click', validar3);
    getBtnC.addEventListener('click', BuscarContra);
    getBtnLO.addEventListener('click', CerrarSesion);

    const baseUrl = 'https://grupolimpio-api.onrender.com';

    function CerrarSesion() {
      fetch(baseUrl + '/logOut', {
          method: 'GET',
          headers: {
          'Content-Type': 'application/json',
          },
      })
      .then(response => response.json())
      .then(data => {
          if(data.msg == "log out"){
            alert('Se ha cerrrado sesion');
            window.location.href = "index.html";
          }else{

          }
      })
      .catch(error => {
          alert('No se ha podido cerrar sesion');
      });
    }

    function Actualizar() {
      fetch(baseUrl + '/Actualizar', {
          method: 'POST',
          headers: {
          'Content-Type': 'application/json',
          },
          body: JSON.stringify({nombre: getNombre.value, apellido: getApellido.value, id: getId.value, telefono: getTelefono.value, 
                ciudad: getCiudad.value, correo: getCorreo.value, fechanacimiento: getNacimiento.value, genero: getGenero.value, direccion: getDireccion.value }),
      })
      .then(response => response.json())
      .then(data => {
          alert('Su informacion a sido actualizada exitosamente!');
          window.location.reload();
      })
      .catch(error => {
          alert('No se ha podido actualizar su informacion');
      });
    }

    function NuevaContra() {
      fetch(baseUrl + '/updatePassword', {
          method: 'POST',
          headers: {
          'Content-Type': 'application/json',
          },
          body: JSON.stringify({correo: getCorreo.value, password: getNuevaContra.value}),
      })
      .then(response => response.json())
      .then(data => {
          alert('Contraseña Actualizada!');
          window.location.reload();
      })
      .catch(error => {
          alert('No se ha podido actualizar la contraseña');
      });
    }

    function BuscarContra() {
      fetch(baseUrl + '/ConfirmPassword', {
          method: 'POST',
          headers: {
          'Content-Type': 'application/json',
          },
          body: JSON.stringify({correo: getCorreo.value}),
      })
      .then(response => response.json())
      .then(data => {
          VerificarContra(data.password);
      })
      .catch(error => {
          console.error('Error:', error);
          alert('Error submitting data' + error);
      });
    }

    function VerificarContra(data) {
      if(document.getElementById("C1Input").value == data){
        NuevaContra();
      }else{
        alert("Las constraseña no es la correcta");
      }
    }

    function CargarDatos() {
      fetch(baseUrl + '/CargarPerfil', {
          method: 'POST',
          headers: {
          'Content-Type': 'application/json',
          },
          body: JSON.stringify({id: localStorage["correo"]}),
      })
      .then(response => response.json())
      .then(data => {
          getNombre.value = data.nombre;
          getApellido.value = data.apellido;
          getCorreo.value = data.correo;
          getTelefono.value = data.telefono;
          getNacimiento.value = data.fechanacimiento;
          getId.value = data.id;
          getGenero.value = data.genero;
          getCiudad.value = data.ciudad;
          getDireccion.value = data.direccion;
      })
      .catch(error => {
          alert('No han podido cargar los datos de su cuenta' + error);
      });
    }

    function validar(){
        if(getId.value.length == 13){
            validar2();
        }else if(getId.value.length == 0){
            alert("Debe de llenar el campo de Identidad");
        }else{
            alert("El numero de identidad debe ser de 13 numeros, sin espacios");
        }
    }

    function validar2(){
        if(getTelefono.value.length == 8){
            validar5();
        }else if(getTelefono.value.length == 0){
            alert("Debe de llenar el campo de Telefono");
        }else{
            alert("El numero de telefono debe ser de 8 numeros, sin espacios");
        }
    }

    function validar3(){
        if(getNombre.value.length == 0){
            alert("Debe de llenar el campo de Nombre");
        }else {
            validar4();
        }
    }

    function validar4(){
        if(getApellido.value.length == 0){
            alert("Debe de llenar el campo de Apellido");
        }else {
            validar();
        }
    }

    function validar5(){
        if(getCiudad.value.length == 0){
            alert("Debe de llenar el campo de Ciudad");
        }else {
            Actualizar();
        }
    }

    function validate() {
        var element = document.getElementById('NombreInput');
        element.value = element.value.replace(/[^a-zA-Z ñÑáéíóúÁÉÍÓÚ]+/, '');
    };

    function validate2() {
        var element2 = document.getElementById('ApellidoInput');
        element2.value = element2.value.replace(/[^a-zA-Z ñÑáéíóúÁÉÍÓÚ]+/, '');
    };

    function validate3() {
        var element2 = document.getElementById('IdentidadInput');
        element2.value = element2.value.replace(/[^0-9]+/, '');
    };

    function validate4() {
        var element2 = document.getElementById('TelefonoInput');
        element2.value = element2.value.replace(/[^0-9]+/, '');
    };
    
    function validate5() {
        var element2 = document.getElementById('CiudadInput');
        element2.value = element2.value.replace(/[^a-zA-Z ñÑáéíóúÁÉÍÓÚ]+/, '');
    };
  </script>

  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
  <script src="https://kit.fontawesome.com/your-fontawesome-kit.js"></script>
  <script src="menu.js"></script>
  <script src="carrusel.js"></script>
  <script src="menu.js"></script>
  <script src="destacados.js"></script>
  <script src="btn.js"></script>
</body>
</body>

</html>