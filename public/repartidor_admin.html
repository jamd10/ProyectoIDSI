<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1">
    <title>Panel de administración</title>
    <link rel="stylesheet" href="admincss/styledashboard.css">
    <link rel="stylesheet"
        href="https://maxst.icons8.com/vue-static/landings/line-awesome/line-awesome/1.3.0/css/line-awesome.min.css">


</head>

<body onload="leerServicio()">
    <input type="checkbox" id="menu-toggle">
    <div class="sidebar">
        <div class="side-header">
            <h3>G<span>rupo + Limpio</span></h3>
        </div>

        <div class="side-content">
            <div class="profile">
                <div class="profile-img bg-img" style="background-image: url(img_admin/3.jpeg)"></div>
                <h4>Inicio</h4>

            </div>

            <div class="side-menu">
                <ul>
                    <li>
                        <a href="index_admin.html">
                            <span class="las la-home"></span>
                            <small>Inicio</small>
                        </a>
                    </li>
                    <li>
                        <a href="productos_admin.html">
                            <span class="las la-shopping-cart"></span>
                            <small>Cátalogo</small>
                        </a>
                    </li>
                    <li>
                        <a href="servicios_admin.html">
                            <span class="las la-clipboard-list"></span>
                            <small>Servicios</small>
                        </a>
                    </li>
                    <li>
                        <a href="repartidor_admin.html" class="active">
                            <span class="las la-truck"></span>
                            <small>Repartidor</small>
                        </a>
                    </li>
                    <li>
                        <a href="pedidos_admin.html">
                            <span class="las la-clipboard-check"></span>
                            <small>Pedidos</small>
                        </a>
                    </li>
                    <li>
                        <a href="marcas_admin.html">
                            <span class="las la-store"></span>
                            <small>Marcas propias</small>
                        </a>
                    </li>
                    <li>
                        <a href="modificarcarrusel.html">
                            <span class="las la-store"></span>
                            <small>Pagina</small>
                        </a>
                    </li>
                    <li>
                        <a href="carrusel_admin.html">
                            <span class="las la-store"></span>
                            <small>Carrusel Inicial</small>
                        </a>
                    </li>
                    <li>
                        <a href="carruselmarcas_admin.html">
                            <span class="las la-store"></span>
                            <small>Carrusel Marcas</small>
                        </a>
                    </li>
                    <li>
                        <a href="index.html">
                            <span class="las la-sign-out-alt"></span>
                            <small>Salir</small>
                        </a>
                    </li>

                </ul>
            </div>
        </div>
    </div>

    <div class="main-content">

        <header>
            <div class="header-content">
                <label for="menu-toggle">
                    <span class="las la-bars"></span>
                </label>
                <div class="header-menu">
                    <div class="user">
                        <div class="bg-img" style="background-image: url(img/3.jpeg)"></div>

                        <button id="CSAdmin" class="logout-link" > Cerrar Sesión </button>

                    </div>
                </div>
            </div>
        </header>


        <main>
            <div class="page-header">
                <h1>Repartidor</h1>
                <small>Panel / Repartidor</small>
            </div>
            <div class="page-content">
                <div class="records table-responsive">
                    <div class="record-header">
                        <div class="add">

                            <button id="openForm">Agregar</button>

                        </div>

                        <!-- <div class="browse">
                            <input type="search" placeholder="Buscar" class="record-search">
                            <select name="" id="">
                                <option value="">Estado</option>
                            </select>
                        </div> -->
                    </div>
                    <div>
                        <table class="product-table" id="TablaServicios">
                            <style>
                                body {
                                    font-family: Arial, sans-serif;
                                    margin: 0;
                                    padding: 0;
                                    display: flex;
                                    justify-content: center;
                                    align-items: center;

                                    background-color: #f5f5f5;
                                }

                                .product-table {
                                    width: 100%;
                                    border-collapse: collapse;
                                    margin-top: 20px;
                                }

                                .product-table th,
                                .product-table td {
                                    border: 1px solid #e7e7e7;
                                    padding: 8px;
                                    text-align: left;
                                }

                                .product-table th {
                                    background-color: #4bcf23c2;
                                }

                                .product-table h4 {
                                    margin: 0;
                                    font-size: 1em;
                                }

                                .product-table p {
                                    margin: 0;
                                    font-size: 0.8em;
                                }

                                .client-img-catalogo {
                                    width: 50px;
                                    height: 50px;
                                    background-size: cover;
                                }

                                .actions {
                                    display: flex;
                                }

                                .action-link {
                                    margin-right: 10px;
                                    text-decoration: none;
                                }
                            </style>
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>NOMBRE</th>
                                    <th>FECHA DE NACIMIENTO</th>
                                    <th>CORREO</th>
                                    <th>CONTRASEÑA</th>
                                    <th>TELEFONO</th>
                                    <th>TIPO DE VEHÍCULO</th>
                                    <th>NUMERO DE PLACA</th>
                                    <th>OPCIONES</th>
                                </tr>
                            </thead>
                            
                        </table>

                    </div>

                </div>

            </div>

        </main>

    </div>
    <div id="myModal" class="modal">
        <div class="modal-content">
            <span class="close">×</span>
            <h2>Agregar repartidor</h2>
            <hr>

            <div class="form-container">
                <div class="row">
                    <div class="column">
                        <label for="identidad">Numero de Identidad:</label>
                        <input type="text" id="identidad" name="identidad" onkeyup="validate2();" maxlength="13">

                        <label for="nombre">Nombre completo:</label>
                        <input type="text" id="nombre" name="nombre" onkeyup="validate();">

                        <label for="fecha">Fecha de Nacimiento:</label>
                        <input type="text" id="fecha" name="fecha" onkeyup="validate3();" maxlength="10">

                        <label for="telefono">Telefono:</label>
                        <input type="text" id="telefono" name="telefono" onkeyup="validate4();" maxlength="8">
                    </div>

                    <div class="column">
                        <label for="correo">Correo:</label>
                        <input id="correo" name="correo"></input>

                        <label for="contra">Contraseña</label>
                        <input type="text" id="contra" name="contra">
      
                        <label for="vehiculo">Tipo de Vehiculo:</label>
                        <textarea id="vehiculo" name="vehiculo"></textarea>

                        <label for="placa">Numero de placa:</label>
                        <input id="placa" name="placa" onkeyup="validate5();" maxlength="7"></input>
                        
                    </div>
                </div>

                <div class="buttons">
                    <button id="AgregarAceptar">Aceptar</button>
                </div>
            </div>
        </div>
    </div>



    <div id="myModal_Modificar" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModificarModal()">×</span>
            <h2>Modificar</h2>
            <hr>

            <div class="form-container">
                <div class="row">
                    <div class="column">

                        <label for="nombre2">Nombre completo:</label>
                        <input type="text" id="nombre2" name="nombre2" onkeyup="validate();">

                        <label for="fecha2">Fecha de Nacimiento:</label>
                        <input type="text" id="fecha2" name="fecha2" onkeyup="validate3();" maxlength="10">

                        <label for="telefono2">Telefono:</label>
                        <input type="text" id="telefono2" name="telefono2" onkeyup="validate4();" maxlength="8">
                    </div>

                    <div class="column">

                        <label for="contra2">Contraseña</label>
                        <input type="text" id="contra2" name="contra2">
      
                        <label for="vehiculo2">Tipo de Vehiculo:</label>
                        <input id="vehiculo2" name="vehiculo2"></input>

                        <label for="placa2">Numero de placa:</label>
                        <input id="placa2" name="placa2" onkeyup="validate5();" maxlength="7"></input>
                        
                    </div>
                </div>

                <div class="buttons">
                    <button id="ModificarAceptar">Aceptar</button>
                </div>
            </div>
        </div>
    </div>

    <div id="myModal_Eliminar" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeEliminarModal()">×</span>
            <h2>Confirmación de Eliminación</h2>
            <hr>

            <p>¿Está seguro de que desea eliminar este cambio? Esta acción es permanente.</p>

            <div class="buttons">
                <button id="EliminarConfirmar">Confirmar</button>
                <button id="cancelarEliminar" onclick="closeEliminarModal()">Cancelar</button>
            </div>
        </div>
    </div>

    <script>
        function openEliminarModal(data) {
            var modalEliminar = document.getElementById('myModal_Eliminar');
            modalEliminar.style.display = 'block';
            localStorage["idS"] = data;
        }

        function closeEliminarModal() {
            var modalEliminar = document.getElementById('myModal_Eliminar');
            modalEliminar.style.display = 'none';
        }

        function eliminarCambio() {
            // Agrega aquí la lógica para eliminar el cambio
            // Puedes hacer una petición AJAX u otro método según tu aplicación
            alert('Cambio eliminado'); // Muestra una alerta como ejemplo
            closeEliminarModal(); // Cierra el modal después de confirmar
        }
    </script>


    <script src="producto.js"></script>


</body>

<script>
    function openModificarModal(data) {
        var modalModificar = document.getElementById('myModal_Modificar');
        modalModificar.style.display = 'block';
        leerModificar(data);
        localStorage["idS"] = data;
    }

    function closeModificarModal() {
        var modalModificar = document.getElementById('myModal_Modificar');
        modalModificar.style.display = 'none';
    }
</script>

<script>
    const getBtnLO = document.getElementById('CSAdmin');
    const Agregarbtn = document.getElementById('AgregarAceptar');
    const Modificarbtn = document.getElementById('ModificarAceptar');
    const Eliminarbtn = document.getElementById('EliminarConfirmar');
    const Tabla = document.getElementById('TablaServicios');

    const nombre = document.getElementById('nombre');
    const identidad = document.getElementById('identidad'); 
    const fecha = document.getElementById('fecha'); 
    const telefono = document.getElementById('telefono'); 
    const correo = document.getElementById('correo'); 
    const vehiculo = document.getElementById('vehiculo');
    const placa = document.getElementById('placa');
    const contra = document.getElementById('contra');

    const nombre2 = document.getElementById('nombre2');
    const fecha2 = document.getElementById('fecha2'); 
    const telefono2 = document.getElementById('telefono2'); 
    const vehiculo2 = document.getElementById('vehiculo2');
    const placa2 = document.getElementById('placa2');
    const contra2 = document.getElementById('contra2');

    getBtnLO.addEventListener('click', CerrarSesion);
    Agregarbtn.addEventListener('click', PreSubmitData);
    Modificarbtn.addEventListener('click', PreActualizar);
    Eliminarbtn.addEventListener('click', Eliminar);

    const baseUrl = 'https://grupolimpio-api.onrender.com';

    function CerrarSesion() {
      fetch(baseUrl + '/logOut', {
        method: 'GET',
        headers: {
          'Content-Type': 'application/json',
        },
      })
        .then(response => response.json())
        .then(data => {
          if (data.msg == "log out") {
            alert('Se ha cerrrado sesion');
            localStorage.removeItem('Admin');
            localStorage.removeItem('correo');
            window.location.href = "index.html";
          } else {

          }
        })
        .catch(error => {
          alert('No se ha podido cerrar sesion');
        });
    }

    function Eliminar() {
        fetch(baseUrl + '/EliminarRepartidor', {
            method: 'POST',
            headers: {
            'Content-Type': 'application/json',
            },
            body: JSON.stringify({ nombre: localStorage["idS"],}),
        })
        .then(response => response.json())
        .then(data => {
            alert('El repartidor a sido eliminado');
            location.reload();
            var modalModificar = document.getElementById('myModal_Modificar');
            modalModificar.style.display = 'none';
        })
        .catch(error => {
            alert('No se ha podido eliminar el repartidor');
        });
    }

    function Actualizar() {
            fetch(baseUrl + '/ActualizarRepartidor', {
                method: 'POST',
                headers: {
                'Content-Type': 'application/json',
                },
                body: JSON.stringify({ nombre: nombre2.value,  
                    fecha: fecha2.value, telefono: telefono2.value,
                    vehiculo: vehiculo2.value, placa: placa2.value, contra: contra2.value,
                    id: localStorage["idS"]}),
            })
            .then(response => response.json())
            .then(data => {
                alert('El repartidor a sido actualizado');
                var modalModificar = document.getElementById('myModal_Modificar');
                modalModificar.style.display = 'none';
                location.reload();
                })
            .catch(error => {
                alert('No se ha podido actualizar su informacion');
            });
        }

    function PreSubmitData(){
        if(nombre.value == ""){
            alert("Ingrese el nombre del repartidor");
        }
        else if(identidad.value.length != 13){
            alert("El numero de identidad del repartidor debe de ser de 13 numeros, sin espacios");
        }
        else if(correo.value == ""){
            alert("Ingrese el correo del repartidor");
        }
        else if(contra.value == ""){
            alert("Ingrese la contraseña");
        }
        else if(fecha.value.length != 10){
            alert("Ingrese la fecha de nacimiento del repartidor, ex: 00/00/0000");
        }
        else if(telefono.value.length != 8){
            alert("El numero de telefono debe de contener 8 numeros");
        }
        else if(vehiculo.value == ""){
            alert("Ingrese la descipcion del vehiculo");
        }
        else if(placa.value.length != 7){
            alert("La placa del vehiculo debe de contener 7 caracteres");
        }
        else{
            CrearUsuario();
        }
    }

    function PreActualizar(){
        if(nombre2.value == ""){
            alert("Ingrese el nombre del repartidor");
        }
        else if(contra2.value == ""){
            alert("Ingrese la contraseña");
        }
        else if(fecha2.value.length != 10){
            alert("Ingrese la fecha de nacimiento del repartidor, ex: 00/00/0000");
        }
        else if(telefono2.value.length != 8){
            alert("El numero de telefono debe de contener 8 numeros");
        }
        else if(vehiculo2.value == ""){
            alert("Ingrese la descipcion del vehiculo");
        }
        else if(placa2.value.length != 7){
            alert("La placa del vehiculo debe de contener 7 caracteres");
        }
        else{
            Actualizar();
        }
    }

    function submitData() {
        fetch(baseUrl + '/CrearRepartidor', {
            method: 'POST',
            headers: {
            'Content-Type': 'application/json',
            },
            body: JSON.stringify({ nombre: nombre.value, numero_identidad: identidad.value, 
                fecha_nacimiento: fecha.value, correo: correo.value, vehiculo: vehiculo.value,
                telefono: telefono.value, placa: placa.value, contra: contra.value, tipo: "Repartidor"}),
        })
        .then(response => response.json())
        .then(data => {
            console.log(data);
            Tabla.innerHTML += `
            <tbody>
                <tr>
                    <td>`+identidad.value+`</td>
                    <td>
                        <h4>`+nombre.value+`</h4>
                    </td>

                    <td>
                        <p>`+fecha.value+`</p>
                    </td>
                    <td>
                        <p>`+correo.value+`</p>
                    </td>
                    <td>
                        <p>`+contra.value+`</p>
                    </td>
                    <td>
                        <p>`+telefono.value+`</p>
                    </td>
                    <td>
                        `+vehiculo.value+`
                    </td>
                    <td>
                        `+placa.value+`
                    </td>
                    <td>
                        <div class="actions">
                            <button id="openForm" onclick=openModificarModal("`+correo.value+`")>
                                <img src="img_admin/boton-editar.png" alt="Agregar">
                            </button>

                            <button id="openForm" onclick=openEliminarModal("`+correo.value+`")>
                                <img src="img_admin/basura.png" alt="Eliminar">
                            </button>
                            </a>
                        </div>
                    </td>
                </tr>
            </tbody>
            `
            alert('Repartidor creado exitosamente');
            nombre.value = "";
            identidad.value = "";
            fecha.value = ""; 
            telefono.value = ""; 
            correo.value = ""; 
            vehiculo.value = "";
            placa.value = "";
            contra.value = "";
        })
        .catch(error => {
            alert('Error Creando Repartidor'+ error);
        });
    }

    function leerServicio() {
            fetch(baseUrl + '/selectRepartidores', {
                method: 'GET',
                headers: {
                'Content-Type': 'application/json',
                },
            })
            .then(response => response.json())
            .then(data => {
                Tabla.innerHTML += ``;
                for(var i = 0; i < data.length; i++){
                    var idtb = data[i].correo;
                    Tabla.innerHTML += `
                    <tbody>
                        <tr>
                            <td>`+data[i].numero_identidad+`</td>
                            <td>
                                <h4>`+data[i].nombre+`</h4>
                            </td>

                            <td>
                                <p>`+data[i].fecha_nacimiento+`</p>
                            </td>
                            <td>
                                <p>`+data[i].correo+`</p>
                            </td>
                            <td>
                                <p>`+data[i].contra+`</p>
                            </td>
                            <td>
                                <p>`+data[i].telefono+`</p>
                            </td>

                            <td>
                                <p>`+data[i].vehiculo+`</p>
                            </td>

                            <td>
                                <p>`+data[i].placa+`</p>
                            </td>
                            <td>
                                <div class="actions">
                                    <button id="openForm" onclick=openModificarModal("`+data[i].correo+`")>
                                        <img src="img_admin/boton-editar.png" alt="Agregar">
                                    </button>

                                    <button id="openForm" onclick=openEliminarModal("`+data[i].correo+`")>
                                        <img src="img_admin/basura.png" alt="Eliminar">
                                    </button>
                                    </a>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                    `
                }
            })
            .catch(error => {
                alert(':('+error);
            });          
        }

        function leerModificar(datas) {
            fetch(baseUrl + '/selectRepartidor', {
                method: 'POST',
                headers: {
                'Content-Type': 'application/json',
                },
                body: JSON.stringify({ id: datas}),
            })
            .then(response => response.json())
            .then(data => {
                console.log(data);
                nombre2.value = data.nombre;
                fecha2.value = data.fecha_nacimiento;
                telefono2.value = data.telefono;
                vehiculo2.value = data.vehiculo;
                placa2.value = data.placa;
                contra2.value = data.contra;
            })
            .catch(error => {
                alert(':('+error);
            });
        }
    
        function CrearUsuario() {
            fetch(baseUrl + '/createUser', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ correo: correo.value, password: contra.value }),
            })
                .then(response => response.json())
                .then(data => {
                    if (data.Error == "auth/missing-email") {
                        alert('Ingrese un correo');
                    } else if (data.Error == "auth/invalid-email") {
                        alert('Ingrese un correo valido');
                    } else if (data.Error == "auth/missing-password") {
                        alert('Ingrese una contraseña');
                    } else if (data.Error == "auth/weak-password") {
                        alert('Ingrese una contraseña fuerte, utilize letras mayusculas, minusculas y numeros u otros caracteres');
                    } else if (data.Error == "auth/email-already-in-use") {
                        alert('Ya existe una cuenta con el correo que ingreso');
                    } else {
                        submitData();
                    }
                })
                .catch(error => {
                    alert('Error al crear usuario, su correo pueda ser que ya este en uso, o su contraseña puede ser muy debil' + error);
                });
        }

    function validate2() {
      var element2 = document.getElementById('identidad');
      element2.value = element2.value.replace(/[^0-9]+/, '');
    };

    function validate3() {
      var element2 = document.getElementById('fecha');
      element2.value = element2.value.replace(/[^0-9/]+/, '');
    };

    function validate() {
      var element = document.getElementById('nombre');
      element.value = element.value.replace(/[^a-zA-Z ñÑáéíóúÁÉÍÓÚ]+/, '');
    };

    function validate4() {
      var element2 = document.getElementById('telefono');
      element2.value = element2.value.replace(/[^0-9]+/, '');
    };

    function validate5() {
      var element2 = document.getElementById('placa');
      element2.value = element2.value.replace(/[^A-Z0-9]+/, '');
    };
</script>



</html>