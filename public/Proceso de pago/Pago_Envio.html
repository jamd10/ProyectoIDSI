<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="Estilos/Barra.css" type="text/css" />
    <link rel="stylesheet" href="Estilos/Informacion.css" type="text/css" />
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="Estilos/footer.css">
    <title>Pago y Envio</title>
    <script src="https://js.stripe.com/v3/"></script>
    <script src="checkout.js" defer></script>


</head>

<body onload="Texto(); DireccionSiNo(); CargarSelects();">
    <div class="logo-container">
        <img class="logo" src="Imagenes/logo.png" alt="Logo de la empresa">

    </div>

    <nav class="form-steps">
        <div class="form-steps__item form-steps__item--completed">
            <div class="form-steps__item-content">
                <span class="form-steps__item-icon">1</span>
                <span class="form-steps__item-text">Iniciar Sesion</span>
            </div>
        </div>
        <div class="form-steps__item form-steps__item--completed">
            <div class="form-steps__item-content">
                <span class="form-steps__item-icon">2</span>
                <span class="form-steps__item-line"></span>
                <span class="form-steps__item-text">Tipo de Entrega</span>
            </div>
        </div>
        <div class="form-steps__item form-steps__item--active">
            <div class="form-steps__item-content">
                <span class="form-steps__item-icon">3</span>
                <span class="form-steps__item-line"></span>
                <span class="form-steps__item-text">Pago y Envio</span>
            </div>
        </div>
        <div class="form-steps__item">
            <div class="form-steps__item-content">
                <span class="form-steps__item-icon">4</span>
                <span class="form-steps__item-line"></span>
                <span class="form-steps__item-text">Verificar Carrito</span>
            </div>
        </div>
        <div class="form-steps__item">
            <div class="form-steps__item-content">
                <span class="form-steps__item-icon">5</span>
                <span class="form-steps__item-line"></span>
                <span class="form-steps__item-text">Confirmar</span>
            </div>
        </div>
    </nav>

    <!-- Información del Usuario -->
    <div class="container mt-5">
        <h3>Información del Usuario</h3>
        <form>
            <div class="form-row">
                <div class="form-group col-md-6">
                    <label for="nombreUsuario">Nombre</label>
                    <input type="text" class="form-control" id="nombreUsuario" value="Nombre del Usuario" readonly>
                </div>
                <div class="form-group col-md-6">
                    <label for="numeroIdentidad">Número de Identidad</label>
                    <input type="text" class="form-control" id="numeroIdentidad" value="123456789" readonly>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group col-md-6">
                    <label for="telefono">Teléfono</label>
                    <input type="text" class="form-control" id="telefono" value="123-456-7890" readonly>
                </div>
                <div class="form-group col-md-6">
                    <label for="correoUsuario">Correo Electrónico</label>
                    <input type="text" class="form-control" id="correoUsuario" value="usuario@example.com" readonly>
                </div>
            </div>
        </form>
    </div>

    <!-- <div id="checkout">
        
    </div> -->

    <!-- Formulario de Tarjeta -->
    <div class="container mt-5">
        <h3>Información de Tarjeta</h3>
        <div class="SubDivMD3">
            <select id="TarjetaSelectPE" class="InputMD">
            </select>
            <span></span>
        </div>
        <form>
            <div class="form-row">
                <div class="form-group col-md-6">
                    <label for="nombreTarjeta">Nombre en la Tarjeta</label>
                    <input type="text" class="form-control" id="nombreTarjeta" placeholder="Nombre completo"  onkeyup="validate8();"required>
                </div>
                <div class="form-group col-md-6">
                    <label for="numeroTarjeta">Número de Tarjeta</label>
                    <input type="text" class="form-control" id="numeroTarjeta" placeholder="1234 5678 9101 1121"
                    onkeyup="validate9();" maxlength="16" required>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group col-md-6">
                    <label for="fechaExpiracion">Fecha de Expiración</label>
                    <input type="text" class="form-control" id="fechaExpiracion" placeholder="MM/YY" onkeyup="validate11();" maxlength="5" required>
                </div>
                <div class="form-group col-md-6">
                    <label for="codigoSeguridad">Código de Seguridad</label>
                    <input type="text" class="form-control" id="codigoSeguridad" placeholder="CVC" onkeyup="validate10();" maxlength="3" required>
                </div>
                <div class="form-group col-md-6">
                    <label for="tipoTarjeta">Tipo de Tarjeta</label>
                    <select id="tipoTarjeta" class="InputIP">
                        <option value=""></option>
                        <option value="visa">Visa</option>
                        <option value="mastercard">Mastercard</option>
                    </select>
                </div>
            </div>
        </form>
    </div>


    <!-- Formulario de Domicilio -->
    <div class="container mt-5" id="DivDom">
        <h3>Información de Domicilio</h3>
        <div class="SubDivMD3">
            <select id="DireccionSelectPE" class="InputMD">
            </select>
            <span></span>
        </div>
        <form>
            <div class="form-row">
                <div class="form-group col-md-6">
                    <label for="direccion">Dirección</label>
                    <input type="text" class="form-control" id="direccion" placeholder="123 Calle Principal" required>
                </div>
                <div class="form-group col-md-6">
                    <label for="ciudad">Ciudad</label>
                    <input type="text" class="form-control" id="ciudad" placeholder="Ciudad" onkeyup="validate5();" required>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group col-md-6">
                    <label for="estado">Estado</label>
                    <input type="text" class="form-control" id="estado" placeholder="Estado" onkeyup="validate7();" required>
                </div>
                <div class="form-group col-md-6">
                    <label for="codigoPostal">Código Postal</label>
                    <input type="text" class="form-control" id="codigoPostal" placeholder="Código Postal" onkeyup="validate6();" maxlength="5" required>
                </div>
            </div>
        </form>
    </div>

    <div class="container mt-5">
        <button type="button" id="ConPE" class="btn btn-success mt-3" onclick="validar5()">Confirmar</button>
        <button type="button" class="btn btn-success mt-3" onclick="Atras()">Atras</button>
    </div>

    <!-- Agregamos el enlace a Bootstrap JS y Popper.js -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>

    <script>
        const DireccionSelect = document.getElementById("DireccionSelectPE");
        const TarjetaSelect = document.getElementById("TarjetaSelectPE");
        DireccionSelect.addEventListener("change", DireccionesTexto);
        TarjetaSelect.addEventListener("change", TarjetasTexto);

        function showInfo() {
            // Obtener los valores de los campos del usuario
            var nombreUsuario = document.getElementById('nombreUsuario').value;
            var numeroIdentidad = document.getElementById('numeroIdentidad').value;
            var telefono = document.getElementById('telefono').value;
            var correoUsuario = document.getElementById('correoUsuario').value;

            // Obtener los valores de los campos de tarjeta y dirección
            var nombreTarjeta = document.getElementById('nombreTarjeta').value;
            var numeroTarjeta = document.getElementById('numeroTarjeta').value;
            var fechaExpiracion = document.getElementById('fechaExpiracion').value;
            var codigoSeguridad = document.getElementById('codigoSeguridad').value;
            var direccion = document.getElementById('direccion').value;
            var ciudad = document.getElementById('ciudad').value;
            var estado = document.getElementById('estado').value;
            var codigoPostal = document.getElementById('codigoPostal').value;

            // Validar que los campos no estén vacíos
            if (
                nombreTarjeta.trim() === '' ||
                numeroTarjeta.trim() === '' ||
                fechaExpiracion.trim() === '' ||
                codigoSeguridad.trim() === '' ||
                direccion.trim() === '' ||
                ciudad.trim() === '' ||
                estado.trim() === '' ||
                codigoPostal.trim() === '' ||
                nombreUsuario.trim() === '' ||
                numeroIdentidad.trim() === '' ||
                telefono.trim() === '' ||
                correoUsuario.trim() === ''
            ) {
                alert("Por favor, completa todos los campos.");
                return;
            }

            // Validar que el número de tarjeta contenga solo números
            if (!/^\d+$/.test(numeroTarjeta)) {
                alert("El número de tarjeta solo puede contener números.");
                return;
            }

            // Validar el formato de fecha de expiración (MM/YY)
            var expiracionRegex = /^(0[1-9]|1[0-2])\/\d{2}$/;
            if (!expiracionRegex.test(fechaExpiracion)) {
                alert("El formato de fecha de expiración debe ser MM/YY.");
                return;
            }

            // Validar que el código de seguridad contenga solo números
            if (!/^\d+$/.test(codigoSeguridad)) {
                alert("El código de seguridad solo puede contener números.");
                return;
            }

            // Si pasa todas las validaciones, mostrar la información
            alert("Información Recopilada:\n" +
                "Usuario:\n" +
                "Nombre: " + nombreUsuario + "\n" +
                "Número de Identidad: " + numeroIdentidad + "\n" +
                "Teléfono: " + telefono + "\n" +
                "Correo Electrónico: " + correoUsuario + "\n\n" +
                "Tarjeta:\n" +
                "Nombre en la Tarjeta: " + nombreTarjeta + "\n" +
                "Número de Tarjeta: " + numeroTarjeta + "\n" +
                "Fecha de Expiración: " + fechaExpiracion + "\n" +
                "Código de Seguridad: " + codigoSeguridad + "\n\n" +
                "Dirección:\n" +
                "Dirección: " + direccion + "\n" +
                "Ciudad: " + ciudad + "\n" +
                "Estado: " + estado + "\n" +
                "Código Postal: " + codigoPostal);
        }

        function Texto(){
            var us = localStorage.getItem('usuario');
            var usuario = us ? JSON.parse(us) : [];
            document.getElementById("nombreUsuario").value = usuario.nombre;
            document.getElementById("numeroIdentidad").value = usuario.id;
            document.getElementById("telefono").value = usuario.telefono;
            document.getElementById("correoUsuario").value = usuario.correo;
        }

        function validate5() {
            var element2 = document.getElementById('ciudad');
            element2.value = element2.value.replace(/[^a-zA-Z ñÑáéíóúÁÉÍÓÚ]+/, '');
        };

        function validate6() {
            var element2 = document.getElementById('codigoPostal');
            element2.value = element2.value.replace(/[^0-9]+/, '');
        };

        function validate7() {
            var element2 = document.getElementById('estado');
            element2.value = element2.value.replace(/[^a-zA-Z ñÑáéíóúÁÉÍÓÚ]+/, '');
        };

        function validate8() {
            var element2 = document.getElementById('nombreTarjeta');
            element2.value = element2.value.replace(/[^a-zA-Z ñÑáéíóúÁÉÍÓÚ]+/, '');
        };

        function validate9() {
            var element2 = document.getElementById('numeroTarjeta');
            element2.value = element2.value.replace(/[^0-9]+/, '');
        };

        function validate10() {
            var element2 = document.getElementById('codigoSeguridad');
            element2.value = element2.value.replace(/[^0-9]+/, '');
        };

        function validate11() {
            var element2 = document.getElementById('fechaExp');
            element2.value = element2.value.replace(/[^0-9/]+/, '');
        };

        function validar5() {
            if (document.getElementById('ciudad').value.length == 0) {
                alert("Debe de llenar el campo de Ciudad");
            } else {
                validar14();
            }
        }

        function validar14(){
            if (document.getElementById('direccion').value.length == 0) {
                alert("Debe de llenar el campo de Direccion");
            } else {
                validar15();
            }
        }

        function validar15(){
            if (document.getElementById('estado').value.length == 0) {
                alert("Debe de llenar el campo de estado");
            } else {
                validar6();
            }
        }

        function validar6() {
            if (document.getElementById('codigoPostal').value.length == 5) {
                validar8();
            } else {
                alert("Debe de llenar el campo de codigo postal");
            }
        }

        function validar8() {
            if (document.getElementById('nombreTarjeta').value.length == 0) {
                alert("Debe de llenar el campode nombre de tarjeta");
            } else {
                validar9();
            }
        }

        function validar9() {
            if (document.getElementById('numeroTarjeta').value.length == 16) {
                validar10();
            } else {
                alert("La tarjeta de credito debe de tener 16 digitos");
            }
        }

        function validar10() {
            if (document.getElementById('fechaExpiracion').value.length == 5) {
                validar11();
            } else {
                alert("La fecha de expiracion debe ser del tipo MM/AA");
            }
        }

        function validar11() {
            if (document.getElementById('codigoSeguridad').value.length == 3) {
                validar12();
            } else {
                alert("El codigo de seguridad debe de tener 3 digitos");
            }
        }

        function validar12() {
            if (document.getElementById('tipoTarjeta').value.length == 0) {
                alert("Debe de seleccionar un tipo de tarjeta");
            } else {
                siguiente();
            }
        }

        function siguiente(){
            var arr = [document.getElementById("nombreUsuario").value, document.getElementById("numeroIdentidad").value,
            document.getElementById("telefono").value, document.getElementById("correoUsuario").value, document.getElementById("nombreTarjeta").value,
            document.getElementById("numeroTarjeta").value, document.getElementById("fechaExpiracion").value, 
            document.getElementById("codigoSeguridad").value, document.getElementById("tipoTarjeta").value, document.getElementById("direccion").value,
            document.getElementById("ciudad").value, document.getElementById("estado").value, document.getElementById("codigoPostal").value]
            localStorage.setItem('FacturaDatos', JSON.stringify(arr));
            window.location.href="Carrito_resumen.html"
        }

        function Atras(){
            window.history.back();
        }

        function DireccionSiNo(){
            if(localStorage["entrega"] == "Tienda"){
                document.getElementById("DivDom").style.display = "none";
                document.getElementById("ConPE").setAttribute("onclick","validar8()");
                document.getElementById("direccion").value = "";
                document.getElementById("ciudad").value = "";
                document.getElementById("estado").value = "";
                document.getElementById("codigoPostal").value = "";

            }else{
                document.getElementById("ConPE").setAttribute("onclick","validar5()");
            }
        }

        function CargarSelects(){
            var us = localStorage.getItem('usuario');
            var usuario = us ? JSON.parse(us) : [];
            if(usuario.direcciones.length !=0 && usuario.tarjetas.length != 0){

                document.getElementById('DireccionSelectPE').innerHTML = "";
                for(var i=0; i<usuario.direcciones.length; i++){
                    var opt = document.createElement('option');
                    opt.value = usuario.direcciones[i].ciudad + ", " + usuario.direcciones[i].direccion;
                    opt.innerHTML = usuario.direcciones[i].ciudad + ", " + usuario.direcciones[i].direccion;
                    document.getElementById('DireccionSelectPE').appendChild(opt);
                }
                DireccionesTexto();

                document.getElementById('TarjetaSelectPE').innerHTML = "";
                for(var i=0; i<usuario.tarjetas.length; i++){
                    var opt = document.createElement('option');
                    var valor = usuario.tarjetas[i].numero_tarjeta.slice(-2)
                    opt.value = "Tarjeta "+ usuario.tarjetas[i].tipo_tarjeta + " que termina en " +valor;
                    opt.innerHTML = "Tarjeta "+ usuario.tarjetas[i].tipo_tarjeta + " que termina en " +valor;
                    document.getElementById('TarjetaSelectPE').appendChild(opt);
                }
                TarjetasTexto();
            }
        }

        function DireccionesTexto(){
            var us = localStorage.getItem('usuario');
            var usuario = us ? JSON.parse(us) : [];
            var select = document.getElementById("DireccionSelectPE")
            document.getElementById("ciudad").value = usuario.direcciones[select.selectedIndex].ciudad;
            document.getElementById("direccion").value = usuario.direcciones[select.selectedIndex].direccion;
            document.getElementById("estado").value = usuario.direcciones[select.selectedIndex].estado;
            document.getElementById("codigoPostal").value = usuario.direcciones[select.selectedIndex].codigo_postal;
        }

        function TarjetasTexto(){
            var us = localStorage.getItem('usuario');
            var usuario = us ? JSON.parse(us) : [];
            var select = document.getElementById("TarjetaSelectPE")
            document.getElementById("nombreTarjeta").value = usuario.tarjetas[select.selectedIndex].nombre_tarjeta;
            document.getElementById("numeroTarjeta").value = usuario.tarjetas[select.selectedIndex].numero_tarjeta;
            document.getElementById("fechaExpiracion").value = usuario.tarjetas[select.selectedIndex].fecha_expiracion;
            document.getElementById("codigoSeguridad").value = usuario.tarjetas[select.selectedIndex].codigo_seguridad;
            document.getElementById("tipoTarjeta").value = usuario.tarjetas[select.selectedIndex].tipo_tarjeta;
        }


    </script>


</body>

</html>