<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1">
    <title>Panel de administración</title>
    <link rel="stylesheet" href="admincss/styledashboard.css">
    <link rel="stylesheet"
        href="https://maxst.icons8.com/vue-static/landings/line-awesome/line-awesome/1.3.0/css/line-awesome.min.css">


</head>

<body onload="leerServicio()">
    <input type="checkbox" id="menu-toggle">
    <div class="sidebar">
        <div class="side-header">
            <h3>G<span>rupo + Limpio</span></h3>
        </div>

        <div class="side-content">
            <div class="profile">
                <div class="profile-img bg-img" style="background-image: url(img_admin/3.jpeg)"></div>
                <h4>Inicio</h4>

            </div>

            <div class="side-menu">
                <ul>
                    <li>
                        <a href="index_admin.html">
                            <span class="las la-home"></span>
                            <small>Inicio</small>
                        </a>
                    </li>
                    <li>
                        <a href="productos_admin.html">
                            <span class="las la-shopping-cart"></span>
                            <small>Cátalogo</small>
                        </a>
                    </li>
                    <li>
                        <a href="servicios_admin.html">
                            <span class="las la-clipboard-list"></span>
                            <small>Servicios</small>
                        </a>
                    </li>
                    <li>
                        <a href="repartidor_admin.html">
                            <span class="las la-truck"></span>
                            <small>Repartidor</small>
                        </a>
                    </li>
                    <li>
                        <a href="pedidos_admin.html" class="active">
                            <span class="las la-clipboard-check"></span>
                            <small>Pedidos</small>
                        </a>
                    </li>
                    <li>
                        <a href="marcas_admin.html">
                            <span class="las la-store"></span>
                            <small>Marcas</small>
                        </a>
                    </li>
                    <li>
                        <a href="carrusel_admin.html">
                            <span class="las la-store"></span>
                            <small>Carrusel Inicial</small>
                        </a>
                    </li>
                    <li>
                        <a href="modificarcarrusel.html">
                            <span class="las la-store"></span>
                            <small>Pagina</small>
                        </a>
                    </li>
                    <li>
                        <a href="index.html">
                            <span class="las la-sign-out-alt"></span>
                            <small>Salir</small>
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </div>

    <div class="main-content">

        <header>
            <div class="header-content">
                <label for="menu-toggle">
                    <span class="las la-bars"></span>
                </label>
                <div class="header-menu">
                    <div class="user">
                        <div class="bg-img" style="background-image: url(img/3.jpeg)"></div>

                        <button id="CSAdmin" class="logout-link" > Cerrar Sesión </button>

                    </div>
                </div>
            </div>
        </header>


        <main>
            <div class="page-header">
                <h1>Pedidos</h1>
                <small>Panel / Pedidos</small>
            </div>
            <div class="page-content">
                <div class="records table-responsive">
                    <div class="record-header">
                    </div>
                    <div>
                        <table class="product-table" id="TablaServicios">
                            <style>
                                body {
                                    font-family: Arial, sans-serif;
                                    margin: 0;
                                    padding: 0;
                                    display: flex;
                                    justify-content: center;
                                    align-items: center;

                                    background-color: #f5f5f5;
                                }

                                .product-table {
                                    width: 100%;
                                    border-collapse: collapse;
                                    margin-top: 20px;
                                }

                                .product-table th,
                                .product-table td {
                                    border: 1px solid #e7e7e7;
                                    padding: 8px;
                                    text-align: left;
                                }

                                .product-table th {
                                    background-color: #4bcf23c2;
                                }

                                .product-table h4 {
                                    margin: 0;
                                    font-size: 1em;
                                }

                                .product-table p {
                                    margin: 0;
                                    font-size: 0.8em;
                                }

                                .client-img-catalogo {
                                    width: 50px;
                                    height: 50px;
                                    background-size: cover;
                                }

                                .actions {
                                    display: flex;
                                }

                                .action-link {
                                    margin-right: 10px;
                                    text-decoration: none;
                                }

                                .InputMD {
                                    padding: 6px 12px;
                                    margin: 8px 0;
                                    display: inline-block;
                                    border: 2px solid #ccc;
                                    border-radius: 4px;
                                    box-sizing: border-box;
                                    width: 40%;
                                }
                            </style>
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>USUARIO</th>
                                    <th>TIPO DE ENTREGA</th>
                                    <th>ESTADO DE ENTREGA</th>
                                    <th>REPARTIDOR</th>
                                    <th>OPCIONES</th>
                                </tr>
                            </thead>
                            
                        </table>

                    </div>

                </div>

            </div>

        </main>

    </div>
    <div id="myModal" class="modal">
        <div class="modal-content">
            <span class="close">×</span>
            <h2>Agregar repartidor</h2>
            <hr>

            <div class="form-container">
                <div class="row">
                    <div class="column">
                        <label for="identidad">Numero de Identidad:</label>
                        <input type="text" id="identidad" name="identidad" onkeyup="validate2();" maxlength="13">

                        <label for="nombre">Nombre completo:</label>
                        <input type="text" id="nombre" name="nombre" onkeyup="validate();">

                        <label for="fecha">Fecha de Nacimiento:</label>
                        <input type="text" id="fecha" name="fecha" onkeyup="validate3();" maxlength="10">

                        <label for="telefono">Telefono:</label>
                        <input type="text" id="telefono" name="telefono" onkeyup="validate4();" maxlength="8">
                    </div>

                    <div class="column">
                        <label for="correo">Correo:</label>
                        <input id="correo" name="correo"></input>
      
                        <label for="vehiculo">Tipo de Vehiculo:</label>
                        <textarea id="vehiculo" name="vehiculo"></textarea>

                        <label for="placa">Numero de placa:</label>
                        <input id="placa" name="placa" onkeyup="validate5();" maxlength="7"></input>
                        
                    </div>
                </div>

                <div class="buttons">
                    <button id="AgregarAceptar">Asignar</button>
                </div>
            </div>
        </div>
    </div>



    <div id="myModal_Modificar" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModificarModal()">×</span>
            <h2>Modificar</h2>
            <hr>

            <div class="form-container">
                <div class="row">
                    <select id="RepartidorSelect" class="InputIP">
                      </select>
                </div>

                <div class="buttons">
                    <button id="ModificarAceptar">Aceptar</button>
                </div>
            </div>
        </div>
    </div>

    <div id="myModal_Eliminar" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeEliminarModal()">×</span>
            <h2>Confirmación de Eliminación</h2>
            <hr>

            <p>¿Está seguro de que desea eliminar este cambio? Esta acción es permanente.</p>

            <div class="buttons">
                <button id="EliminarConfirmar">Confirmar</button>
                <button id="cancelarEliminar" onclick="closeEliminarModal()">Cancelar</button>
            </div>
        </div>
    </div>

    <script>
        function openEliminarModal(data) {
            var modalEliminar = document.getElementById('myModal_Eliminar');
            modalEliminar.style.display = 'block';
            localStorage["idS"] = data;
        }

        function closeEliminarModal() {
            var modalEliminar = document.getElementById('myModal_Eliminar');
            modalEliminar.style.display = 'none';
        }

        function eliminarCambio() {
            // Agrega aquí la lógica para eliminar el cambio
            // Puedes hacer una petición AJAX u otro método según tu aplicación
            alert('Cambio eliminado'); // Muestra una alerta como ejemplo
            closeEliminarModal(); // Cierra el modal después de confirmar
        }
    </script>


    <script src="producto.js"></script>


</body>

<script>
    function openModificarModal(data) {
        var modalModificar = document.getElementById('myModal_Modificar');
        modalModificar.style.display = 'block';
        leerModificar();
        localStorage["idS"] = data;
    }

    function closeModificarModal() {
        var modalModificar = document.getElementById('myModal_Modificar');
        modalModificar.style.display = 'none';
    }
</script>

<script>
    const getBtnLO = document.getElementById('CSAdmin');
    const Agregarbtn = document.getElementById('AgregarAceptar');
    const Modificarbtn = document.getElementById('ModificarAceptar');
    const Eliminarbtn = document.getElementById('EliminarConfirmar');
    const Tabla = document.getElementById('TablaServicios');

    const select = document.getElementById('RepartidorSelect');

    getBtnLO.addEventListener('click', CerrarSesion);
    Agregarbtn.addEventListener('click', submitData);
    Modificarbtn.addEventListener('click', submitData);
    Eliminarbtn.addEventListener('click', Eliminar);

    const baseUrl = 'https://grupolimpio-api.onrender.com';

    function CerrarSesion() {
      fetch(baseUrl + '/logOut', {
        method: 'GET',
        headers: {
          'Content-Type': 'application/json',
        },
      })
        .then(response => response.json())
        .then(data => {
          if (data.msg == "log out") {
            alert('Se ha cerrrado sesion');
            localStorage.removeItem('Admin');
            localStorage.removeItem('correo');
            window.location.href = "index.html";
          } else {

          }
        })
        .catch(error => {
          alert('No se ha podido cerrar sesion');
        });
    }

    function Eliminar() {
        fetch(baseUrl + '/ActualizarFactura', {
            method: 'POST',
            headers: {
            'Content-Type': 'application/json',
            },
            body: JSON.stringify({ id: localStorage["idS"], texto: "Cancelado"}),
        })
        .then(response => response.json())
        .then(data => {
            location.reload();
        })
        .catch(error => {
            alert('No se ha podido eliminar el repartidor');
        });
    }

    function Eliminar2() {
        fetch(baseUrl + '/EliminarRepartidor', {
            method: 'POST',
            headers: {
            'Content-Type': 'application/json',
            },
            body: JSON.stringify({ nombre: localStorage["idS"],}),
        })
        .then(response => response.json())
        .then(data => {
            alert('El repartidor a sido eliminado');
            location.reload();
            var modalModificar = document.getElementById('myModal_Modificar');
            modalModificar.style.display = 'none';
        })
        .catch(error => {
            alert('No se ha podido eliminar el repartidor');
        });
    }

    function Actualizar() {
        fetch(baseUrl + '/ActualizarFactura', {
            method: 'POST',
            headers: {
            'Content-Type': 'application/json',
            },
            body: JSON.stringify({ id: localStorage["idS"],texto: "Asignado"}),
        })
        .then(response => response.json())
        .then(data => {

        })
        .catch(error => {
            //alert('No se ha podido actualizar su informacion'+error);
        });
    }


    function PreActualizar(){
        if(nombre2.value == ""){
            alert("Ingrese el nombre del repartidor");
        }
        else if(identidad2.value.length != 13){
            alert("El numero de identidad del repartidor debe de ser de 13 numeros, sin espacios");
        }
        else if(correo2.value == ""){
            alert("Ingrese el correo del repartidor");
        }
        else if(fecha2.value.length != 10){
            alert("Ingrese la fecha de nacimiento del repartidor, ex: 00/00/0000");
        }
        else if(telefono2.value.length != 8){
            alert("El numero de telefono debe de contener 8 numeros");
        }
        else if(vehiculo2.value == ""){
            alert("Ingrese la descipcion del vehiculo");
        }
        else if(placa2.value.length != 7){
            alert("La placa del vehiculo debe de contener 7 caracteres");
        }
        else{
            Actualizar();
        }
    }

    function HayPedido() {

    }

    function submitData() {
        fetch(baseUrl + '/ActualizarFactura2', {
            method: 'POST',
            headers: {
            'Content-Type': 'application/json',
            },
            body: JSON.stringify({ repartidor: select.value, id: localStorage["idS"], texto: "Asignado"}),
        })
        .then(response => response.json())
        .then(data => {
            alert("Se asigno el pedido al repartido");
            location.reload();
        })
        .catch(error => {
            alert('Error asignando pedido'+ error);
        });
    }

    function leerServicio() {
            fetch(baseUrl + '/selectFacturas', {
                method: 'GET',
                headers: {
                'Content-Type': 'application/json',
                },
            })
            .then(response => response.json())
            .then(data => {
                Tabla.innerHTML += ``;
                for(var i = 0; i < data.length; i++){
                    if(data[i].estado_entrega == "Entregado" || data[i].estado_entrega == "Cancelado"){

                    }
                    else if(data[i].tipoEntrega == "Tienda"){
                        Tabla.innerHTML += `
                        <tbody>
                            <tr>
                                <td>`+data[i].id+`</td>
                                <td>
                                    <h4>`+data[i].usuario+`</h4>
                                </td>

                                <td>
                                    <p>`+data[i].tipoEntrega+`</p>
                                </td>
                                <td>
                                    <p>`+data[i].estado_entrega+`</p>
                                </td>
                                <td>
                                    <p>`+""+`</p>
                                </td>
                                <td>
                                    <div class="actions">
                                        <button id="openForm" onclick=openEliminarModal("`+data[i].id+`")>
                                            <img src="img_admin/basura.png" alt="Eliminar">
                                        </button>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                        `;
                    }else{
                        Tabla.innerHTML += `
                        <tbody>
                            <tr>
                                <td>`+data[i].id+`</td>
                                <td>
                                    <h4>`+data[i].usuario+`</h4>
                                </td>

                                <td>
                                    <p>`+data[i].tipoEntrega+`</p>
                                </td>
                                <td>
                                    <p>`+data[i].estado_entrega+`</p>
                                </td>
                                <td>
                                    <p>`+data[i].repartidor+`</p>
                                </td>
                                <td>
                                    <div class="actions">
                                        <button id="openForm" onclick=openModificarModal("`+data[i].id+`")>
                                            <img src="img_admin/boton-editar.png" alt="Agregar">
                                        </button>
                                        <button id="openForm" onclick=openEliminarModal("`+data[i].id+`")>
                                            <img src="img_admin/basura.png" alt="Eliminar">
                                        </button>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                        `;
                    }
                }
            })
            .catch(error => {
                alert(':('+error);
            });          
        }

        function leerModificar() {
            fetch(baseUrl + '/selectRepartidores', {
                method: 'GET',
                headers: {
                'Content-Type': 'application/json',
                },
            })
            .then(response => response.json())
            .then(data => {
                document.getElementById('RepartidorSelect').innerHTML = "";
                for(var i=0; i<data.length; i++){
                    var opt = document.createElement('option');
                    opt.value = data[i].correo;
                    opt.innerHTML = data[i].nombre;
                    document.getElementById('RepartidorSelect').appendChild(opt);
                }
            })
            .catch(error => {
                alert(':('+error);
            });
        }

    function validate2() {
      var element2 = document.getElementById('identidad');
      element2.value = element2.value.replace(/[^0-9]+/, '');
    };

    function validate3() {
      var element2 = document.getElementById('fecha');
      element2.value = element2.value.replace(/[^0-9/]+/, '');
    };

    function validate() {
      var element = document.getElementById('nombre');
      element.value = element.value.replace(/[^a-zA-Z ñÑáéíóúÁÉÍÓÚ]+/, '');
    };

    function validate4() {
      var element2 = document.getElementById('telefono');
      element2.value = element2.value.replace(/[^0-9]+/, '');
    };

    function validate5() {
      var element2 = document.getElementById('placa');
      element2.value = element2.value.replace(/[^A-Z0-9]+/, '');
    };
</script>



</html>